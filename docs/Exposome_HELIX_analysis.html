<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Exposome data analysis in HELIX data. | Applications of OmicDataSHIELD in real data</title>
  <meta name="description" content="2 Exposome data analysis in HELIX data. | Applications of OmicDataSHIELD in real data" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Exposome data analysis in HELIX data. | Applications of OmicDataSHIELD in real data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Exposome data analysis in HELIX data. | Applications of OmicDataSHIELD in real data" />
  
  
  



<meta name="date" content="2022-03-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Datasets_Description.html"/>
<link rel="next" href="references..html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script>
  function unrolltab(evt, divName, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementById(divName).getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementById(divName).getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function(event) { 
    document.getElementById("gwas_results_1").click();
    document.getElementById("gwas_plot_1").click();
    document.getElementById("manhattan-plots-tab").click();
    document.getElementById("locuszoom-plots-tabs").click();
 });
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="" target="blank">OmicSHIELD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="Datasets_Description.html"><a href="Datasets_Description.html"><i class="fa fa-check"></i><b>1</b> Datasets description.</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Datasets_Description.html"><a href="Datasets_Description.html#cineca-project."><i class="fa fa-check"></i><b>1.1</b> CINECA project.</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Datasets_Description.html"><a href="Datasets_Description.html#data-organization-in-the-opal-server."><i class="fa fa-check"></i><b>1.1.1</b> Data organization in the opal server.</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Datasets_Description.html"><a href="Datasets_Description.html#helix-project."><i class="fa fa-check"></i><b>1.2</b> HELIX project.</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Datasets_Description.html"><a href="Datasets_Description.html#data-organization-in-the-opal-server.-1"><i class="fa fa-check"></i><b>1.2.1</b> Data organization in the opal server.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html"><i class="fa fa-check"></i><b>2</b> Exposome data analysis in HELIX data.</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html#getting-started."><i class="fa fa-check"></i><b>2.1</b> Getting started.</a></li>
<li class="chapter" data-level="2.2" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html#data-formatting-and-manipulation-in-datashield."><i class="fa fa-check"></i><b>2.2</b> Data formatting and manipulation in DataSHIELD.</a></li>
<li class="chapter" data-level="2.3" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html#implementation-of-exwas-in-datashield."><i class="fa fa-check"></i><b>2.3</b> Implementation of ExWAS in DataSHIELD.</a></li>
<li class="chapter" data-level="2.4" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html#feature-selection-with-penalized-methods"><i class="fa fa-check"></i><b>2.4</b> Feature selection with penalized methods</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html#ds.ls_lasso-function."><i class="fa fa-check"></i><b>2.4.1</b> <em>ds.LS_Lasso()</em> function.</a></li>
<li class="chapter" data-level="2.4.2" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html#ds.lasso_train-function."><i class="fa fa-check"></i><b>2.4.2</b> <em>ds.Lasso_Train()</em> function.</a></li>
<li class="chapter" data-level="2.4.3" data-path="Exposome_HELIX_analysis.html"><a href="Exposome_HELIX_analysis.html#ds.lasso_cvinsite-function."><i class="fa fa-check"></i><b>2.4.3</b> <em>ds.Lasso_CVInSite()</em> function.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="references..html"><a href="references..html"><i class="fa fa-check"></i><b>3</b> References.</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applications of OmicDataSHIELD in real data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Exposome_HELIX_analysis" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Exposome data analysis in HELIX data.</h1>
<p>The main aim of this <strong>chapter</strong> is to illustrate how to perform <strong>exposome analyses</strong> on a <strong>multi-centre study</strong> in a non-disclosive way using <strong>DataSHIELD</strong>. Particularly, we will cover how to apply some of the most frequently employed techniques in <strong>exposome analysis</strong> such is the case of <strong>Exposome Wide Association Analysis (ExWAS)</strong> or <strong>variable selection with penalized regressions</strong>. To illustrate the power and possibilities emanating from <strong>DataSHIELD</strong> in the context of <strong>exposome analysis</strong>, we will <strong>replicate</strong> some of the analyses presented in the work of <span class="citation">(<a href="#ref-WAREMBOURG20191317" role="doc-biblioref">Warembourg et al. 2019</a>)</span>, in which the association between a wide range of <strong>prenatal and postnatal exposures</strong> and <strong>blood pressure (BP)</strong> in children is investigated.</p>
<p>For this purpose, we will use the <strong>exposome data</strong> from the <strong>HELIX project</strong> previously described (@ref(Exposome_HELIX_Data)), and two <strong>DataSHIELD packages</strong> designed for such purposes; (1) the <em>“dsExposomeClient”</em> (CITA) from our research group, and (2) the <a href="https://github.com/transbioZI/dsMTLBase"><strong>dsMTL (Federated Multi-Task Learning based on DataSHIELD)</strong></a> from <span class="citation">(<a href="#ref-Cao2021.08.26.457778" role="doc-biblioref"><strong>Cao2021.08.26.457778?</strong></a>)</span>.</p>
<p>In this <strong>tutorial</strong>, we will give a <strong>general overview</strong> of how to implement some of the main functions of these packages in the context of a <strong>multi-centre exposome study</strong>. Some <strong>topics</strong> covered in this <strong>tutorial</strong> include: 1) Setting up the <strong>R environment</strong> for working with these packages in <strong>DataSHIELD</strong>, 2) <strong>Loading the HELIX showcase data</strong> from an <strong>Opal</strong> server into the <strong>DataSHIELD</strong> environment, and 3) Application of <strong>ExWAS</strong> for multiple association analysis, and <strong>Lasso regression</strong> for <strong>variable-selection</strong>.</p>
<div id="getting-started." class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Getting started.</h2>
<p>In this section, we will describe how to <strong>configure R and DataSHIELD</strong> with the <strong>needed packages</strong> to carry out proposed of analyses in remote. First, it is necessary to <strong>install</strong> the <em>client-side</em> version of the following <strong>DataSHIELD/Opal</strong> integration packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="Exposome_HELIX_analysis.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&#39;DSOpal&#39;</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="Exposome_HELIX_analysis.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;DSI&quot;</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Make sure you also install the <strong>DataSHIELD</strong> <em>client-side</em> version of the packages <em>“dsBaseClient”</em> and <em>“dsBase”</em>. The <em>“dsBaseClient”</em> package needs to be a client which is version 6.0.0 or higher.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="Exposome_HELIX_analysis.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dsBase&quot;</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-2"><a href="Exposome_HELIX_analysis.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dsBaseClient&quot;</span>, <span class="at">repos =</span> <span class="fu">c</span>(<span class="st">&quot;http://cran.datashield.org&quot;</span>, <span class="st">&quot;https://cloud.r-project.org/&quot;</span>), <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Then, install the <em>client-side</em> version of the <em>“dsExposomeClient”</em> and <em>“dsMTL”</em> packages directly from <em>GitHub</em>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="Exposome_HELIX_analysis.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb3-2"><a href="Exposome_HELIX_analysis.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb3-3"><a href="Exposome_HELIX_analysis.html#cb3-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;transbioZI/dsMTLClient&quot;</span>)</span>
<span id="cb3-4"><a href="Exposome_HELIX_analysis.html#cb3-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;isglobal-brge/dsExposomeClient@1.1.2&#39;</span>)</span></code></pre></div>
<p>Once installations are complete, all the packages are <strong>loaded</strong> as usual.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="Exposome_HELIX_analysis.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DSI)</span>
<span id="cb4-2"><a href="Exposome_HELIX_analysis.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DSOpal)</span>
<span id="cb4-3"><a href="Exposome_HELIX_analysis.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsBaseClient)</span>
<span id="cb4-4"><a href="Exposome_HELIX_analysis.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsMTLClient)</span>
<span id="cb4-5"><a href="Exposome_HELIX_analysis.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsExposomeClient)</span></code></pre></div>
<p>In this <strong>tutorial</strong>, we will use the <a href="https://datashield.isglobal.org/brge/ui/index.html">Opal BRGE site</a> to illustrate how to perform mentioned analyses in <strong>DataSHIELD</strong>. Details for <strong>accessing</strong> the server can be found below. We will employ an user who have <strong>DataSHIELD</strong> permissions to Opal servers called <em>“dsuser</em>.</p>
</div>
<div id="data-formatting-and-manipulation-in-datashield." class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Data formatting and manipulation in DataSHIELD.</h2>
<p>In this section, we will cover how to <strong>manipulate</strong> and <strong>prepare</strong> <strong>input data</strong> with <strong>DataSHIELD</strong> according to the needs of the functions available in the <em>“dsExposomeClient”</em> and <em>“dsMTL”</em> packages.</p>
<p>We start by <strong>creating the connection to the opal server</strong> using an user who have <strong>DataSHIELD permissions</strong> to Opal servers (<strong>dsuser</strong>). Please, note that in our example, all datasets are hosted in the same Opal but each cohort sub-dataset is accessed separately. In the case each cohort dataset was available in a different opal, the way of login data would be the same but specifying different connection details.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="Exposome_HELIX_analysis.html#cb5-1" aria-hidden="true" tabindex="-1"></a>builder <span class="ot">&lt;-</span> DSI<span class="sc">::</span><span class="fu">newDSLoginBuilder</span>()</span>
<span id="cb5-2"><a href="Exposome_HELIX_analysis.html#cb5-2" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server =</span> <span class="st">&quot;BIB&quot;</span>, <span class="at">url =</span> <span class="st">&quot;https://datashield.isglobal.org/repo&quot;</span>,</span>
<span id="cb5-3"><a href="Exposome_HELIX_analysis.html#cb5-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">user =</span>  <span class="st">&quot;jrgonzalez&quot;</span>, <span class="at">password =</span> <span class="st">&quot;Z2Z//B5&quot;</span>,</span>
<span id="cb5-4"><a href="Exposome_HELIX_analysis.html#cb5-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">driver =</span> <span class="st">&quot;OpalDriver&quot;</span>, <span class="at">profile =</span> <span class="st">&quot;rock-inma&quot;</span>)</span>
<span id="cb5-5"><a href="Exposome_HELIX_analysis.html#cb5-5" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server =</span> <span class="st">&quot;EDEN&quot;</span>, <span class="at">url =</span> <span class="st">&quot;https://datashield.isglobal.org/repo&quot;</span>,</span>
<span id="cb5-6"><a href="Exposome_HELIX_analysis.html#cb5-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">user =</span>  <span class="st">&quot;jrgonzalez&quot;</span>, <span class="at">password =</span> <span class="st">&quot;Z2Z//B5&quot;</span>,</span>
<span id="cb5-7"><a href="Exposome_HELIX_analysis.html#cb5-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">profile =</span> <span class="st">&quot;rock-inma&quot;</span>)</span>
<span id="cb5-8"><a href="Exposome_HELIX_analysis.html#cb5-8" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server =</span> <span class="st">&quot;KANC&quot;</span>, <span class="at">url =</span> <span class="st">&quot;https://datashield.isglobal.org/repo&quot;</span>,</span>
<span id="cb5-9"><a href="Exposome_HELIX_analysis.html#cb5-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">user =</span>  <span class="st">&quot;jrgonzalez&quot;</span>, <span class="at">password =</span> <span class="st">&quot;Z2Z//B5&quot;</span>,</span>
<span id="cb5-10"><a href="Exposome_HELIX_analysis.html#cb5-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">profile =</span> <span class="st">&quot;rock-inma&quot;</span>)</span>
<span id="cb5-11"><a href="Exposome_HELIX_analysis.html#cb5-11" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server =</span> <span class="st">&quot;MoBA&quot;</span>, <span class="at">url =</span> <span class="st">&quot;https://datashield.isglobal.org/repo&quot;</span>,</span>
<span id="cb5-12"><a href="Exposome_HELIX_analysis.html#cb5-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">user =</span>  <span class="st">&quot;jrgonzalez&quot;</span>, <span class="at">password =</span> <span class="st">&quot;Z2Z//B5&quot;</span>,</span>
<span id="cb5-13"><a href="Exposome_HELIX_analysis.html#cb5-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">profile =</span> <span class="st">&quot;rock-inma&quot;</span>)</span>
<span id="cb5-14"><a href="Exposome_HELIX_analysis.html#cb5-14" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server =</span> <span class="st">&quot;Rhea&quot;</span>, <span class="at">url =</span> <span class="st">&quot;https://datashield.isglobal.org/repo&quot;</span>,</span>
<span id="cb5-15"><a href="Exposome_HELIX_analysis.html#cb5-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">user =</span>  <span class="st">&quot;jrgonzalez&quot;</span>, <span class="at">password =</span> <span class="st">&quot;Z2Z//B5&quot;</span>,</span>
<span id="cb5-16"><a href="Exposome_HELIX_analysis.html#cb5-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">profile =</span> <span class="st">&quot;rock-inma&quot;</span>)</span>
<span id="cb5-17"><a href="Exposome_HELIX_analysis.html#cb5-17" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server =</span> <span class="st">&quot;INMASAB&quot;</span>, <span class="at">url =</span> <span class="st">&quot;https://datashield.isglobal.org/repo&quot;</span>,</span>
<span id="cb5-18"><a href="Exposome_HELIX_analysis.html#cb5-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">user =</span>  <span class="st">&quot;jrgonzalez&quot;</span>, <span class="at">password =</span> <span class="st">&quot;Z2Z//B5&quot;</span>,</span>
<span id="cb5-19"><a href="Exposome_HELIX_analysis.html#cb5-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">profile =</span> <span class="st">&quot;rock-inma&quot;</span>)</span>
<span id="cb5-20"><a href="Exposome_HELIX_analysis.html#cb5-20" aria-hidden="true" tabindex="-1"></a>logindata <span class="ot">&lt;-</span> builder<span class="sc">$</span><span class="fu">build</span>()</span>
<span id="cb5-21"><a href="Exposome_HELIX_analysis.html#cb5-21" aria-hidden="true" tabindex="-1"></a>conns <span class="ot">&lt;-</span> DSI<span class="sc">::</span><span class="fu">datashield.login</span>(<span class="at">logins =</span> logindata)</span></code></pre></div>
<p>Next, we will <strong>load</strong> each of the <strong>resources</strong> available in the <strong>Opal server</strong>, corresponding to each <strong>cohort “exposomeSet”</strong>, using the <em>DSI::datashield.assign.resource()</em> function and each of the connections to the server created in the previous code chunk. This way, we <strong>assign all available resource objects in the Opal</strong> to an R object called <strong>“resource”</strong> in the <strong>DataSHIELD remote session</strong>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="Exposome_HELIX_analysis.html#cb6-1" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.resource</span>(conns[<span class="dv">1</span>], <span class="st">&quot;resource&quot;</span>, <span class="st">&quot;HELIX.postnatal_BIB&quot;</span>)</span>
<span id="cb6-2"><a href="Exposome_HELIX_analysis.html#cb6-2" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.resource</span>(conns[<span class="dv">2</span>], <span class="st">&quot;resource&quot;</span>, <span class="st">&quot;HELIX.postnatal_EDE&quot;</span>)</span>
<span id="cb6-3"><a href="Exposome_HELIX_analysis.html#cb6-3" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.resource</span>(conns[<span class="dv">3</span>], <span class="st">&quot;resource&quot;</span>, <span class="st">&quot;HELIX.postnatal_KAN&quot;</span>)</span>
<span id="cb6-4"><a href="Exposome_HELIX_analysis.html#cb6-4" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.resource</span>(conns[<span class="dv">4</span>], <span class="st">&quot;resource&quot;</span>, <span class="st">&quot;HELIX.postnatal_MOB&quot;</span>)</span>
<span id="cb6-5"><a href="Exposome_HELIX_analysis.html#cb6-5" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.resource</span>(conns[<span class="dv">5</span>], <span class="st">&quot;resource&quot;</span>, <span class="st">&quot;HELIX.postnatal_RHE&quot;</span>)</span>
<span id="cb6-6"><a href="Exposome_HELIX_analysis.html#cb6-6" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.resource</span>(conns[<span class="dv">6</span>], <span class="st">&quot;resource&quot;</span>, <span class="st">&quot;HELIX.postnatal_SAB&quot;</span>)</span></code></pre></div>
<p>Next, we have to <strong>resolve the resources</strong> and <strong>retrieve the data in the remote session</strong>. For that, we will use the <em>DSI::datashield.assign.expr()</em> function. This function will assign the result of the execution of the argument <strong>“expr”</strong> to an R object called <strong>“exposome_set”</strong> in the <strong>Datashield remote session</strong>. In particular, we run the function <em>as.resource.object()</em>, which is the <strong>DataSHIELD</strong> function in charge of resolving resources (it coerces the resource to an internal data object that depends on the implementation of the object). As a result, we will get an <strong>R object</strong> (here named “exposome_Set”) containing the <strong>“exposomeSets”</strong> files for all cohorts.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="Exposome_HELIX_analysis.html#cb7-1" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.expr</span>(<span class="at">conns =</span> conns, <span class="at">symbol =</span> <span class="st">&quot;exposome_set&quot;</span>,</span>
<span id="cb7-2"><a href="Exposome_HELIX_analysis.html#cb7-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">expr =</span> <span class="fu">as.symbol</span>(<span class="st">&quot;as.resource.object(resource)&quot;</span>))</span></code></pre></div>
<p>Once we have loaded the resources, we have also to load each of the <strong>tables with additional phenotypes</strong> available for each cohort in the <strong>Opal server</strong>. For that purpose, we will use the <em>DSI::datashield.assign.table()</em> function, which assigns <strong>tables</strong> to an R object in the <strong>remote session</strong> (here named <strong>“pheno”</strong>). As a result, the “pheno” object will contain <strong>six data.frames</strong> corresponding to each of the tables with extra phenotypes for cohorts.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="Exposome_HELIX_analysis.html#cb8-1" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.table</span>(conns[<span class="dv">1</span>], <span class="st">&quot;pheno&quot;</span>, <span class="st">&quot;HELIX.subclinical_cardio_BIB&quot;</span>)</span>
<span id="cb8-2"><a href="Exposome_HELIX_analysis.html#cb8-2" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.table</span>(conns[<span class="dv">2</span>], <span class="st">&quot;pheno&quot;</span>, <span class="st">&quot;HELIX.subclinical_cardio_EDE&quot;</span>)</span>
<span id="cb8-3"><a href="Exposome_HELIX_analysis.html#cb8-3" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.table</span>(conns[<span class="dv">3</span>], <span class="st">&quot;pheno&quot;</span>, <span class="st">&quot;HELIX.subclinical_cardio_KAN&quot;</span>)</span>
<span id="cb8-4"><a href="Exposome_HELIX_analysis.html#cb8-4" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.table</span>(conns[<span class="dv">4</span>], <span class="st">&quot;pheno&quot;</span>, <span class="st">&quot;HELIX.subclinical_cardio_MOB&quot;</span>)</span>
<span id="cb8-5"><a href="Exposome_HELIX_analysis.html#cb8-5" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.table</span>(conns[<span class="dv">5</span>], <span class="st">&quot;pheno&quot;</span>, <span class="st">&quot;HELIX.subclinical_cardio_RHE&quot;</span>)</span>
<span id="cb8-6"><a href="Exposome_HELIX_analysis.html#cb8-6" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.assign.table</span>(conns[<span class="dv">6</span>], <span class="st">&quot;pheno&quot;</span>, <span class="st">&quot;HELIX.subclinical_cardio_SAB&quot;</span>)</span></code></pre></div>
<p>To <strong>verify previous steps were performed correctly</strong>, we could use some <strong>descriptive functions</strong> on created objects. For example, we can check the names of the variables included in each object, and ensure this way that they exist on the remote session.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="Exposome_HELIX_analysis.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Which is the class of the remote R objects &quot;exposome_set&quot; and &quot;pheno&quot;:</span></span>
<span id="cb9-2"><a href="Exposome_HELIX_analysis.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.class</span>(<span class="st">&quot;exposome_set&quot;</span>)</span></code></pre></div>
<pre><code>$BIB
[1] &quot;ExposomeSet&quot;
attr(,&quot;package&quot;)
[1] &quot;rexposome&quot;

$EDEN
[1] &quot;ExposomeSet&quot;
attr(,&quot;package&quot;)
[1] &quot;rexposome&quot;

$KANC
[1] &quot;ExposomeSet&quot;
attr(,&quot;package&quot;)
[1] &quot;rexposome&quot;

$MoBA
[1] &quot;ExposomeSet&quot;
attr(,&quot;package&quot;)
[1] &quot;rexposome&quot;

$Rhea
[1] &quot;ExposomeSet&quot;
attr(,&quot;package&quot;)
[1] &quot;rexposome&quot;

$INMASAB
[1] &quot;ExposomeSet&quot;
attr(,&quot;package&quot;)
[1] &quot;rexposome&quot;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="Exposome_HELIX_analysis.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.class</span>(<span class="st">&quot;pheno&quot;</span>)</span></code></pre></div>
<pre><code>$BIB
[1] &quot;data.frame&quot;

$EDEN
[1] &quot;data.frame&quot;

$KANC
[1] &quot;data.frame&quot;

$MoBA
[1] &quot;data.frame&quot;

$Rhea
[1] &quot;data.frame&quot;

$INMASAB
[1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="Exposome_HELIX_analysis.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the number of exposures, phenotypes and individuals in each file:</span></span>
<span id="cb13-2"><a href="Exposome_HELIX_analysis.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.dim</span>(<span class="st">&quot;pheno&quot;</span>)</span></code></pre></div>
<pre><code>$`dimensions of pheno in BIB`
[1] 231   7

$`dimensions of pheno in EDEN`
[1] 205   7

$`dimensions of pheno in KANC`
[1] 207   7

$`dimensions of pheno in MoBA`
[1] 291   7

$`dimensions of pheno in Rhea`
[1] 200   7

$`dimensions of pheno in INMASAB`
[1] 489   7

$`dimensions of pheno in combined studies`
[1] 1623    7</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="Exposome_HELIX_analysis.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># si se lanza en el chunk de primeras falla, si se vuelve a lanzar funciona. ds.dim(&quot;exposome_set&quot;)</span></span>
<span id="cb15-2"><a href="Exposome_HELIX_analysis.html#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="Exposome_HELIX_analysis.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the name of the columns available in the data.frames of the pheno object:</span></span>
<span id="cb15-4"><a href="Exposome_HELIX_analysis.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.colnames</span>(<span class="st">&quot;pheno&quot;</span>)</span></code></pre></div>
<pre><code>$BIB
[1] &quot;HelixID&quot;         &quot;hs_bp_sys&quot;       &quot;hs_bp_dia&quot;       &quot;hs_zsys_bp&quot;     
[5] &quot;hs_zdia_bp&quot;      &quot;hs_hypertensive&quot; &quot;hs_waist&quot;       

$EDEN
[1] &quot;HelixID&quot;         &quot;hs_bp_sys&quot;       &quot;hs_bp_dia&quot;       &quot;hs_zsys_bp&quot;     
[5] &quot;hs_zdia_bp&quot;      &quot;hs_hypertensive&quot; &quot;hs_waist&quot;       

$KANC
[1] &quot;HelixID&quot;         &quot;hs_bp_sys&quot;       &quot;hs_bp_dia&quot;       &quot;hs_zsys_bp&quot;     
[5] &quot;hs_zdia_bp&quot;      &quot;hs_hypertensive&quot; &quot;hs_waist&quot;       

$MoBA
[1] &quot;HelixID&quot;         &quot;hs_bp_sys&quot;       &quot;hs_bp_dia&quot;       &quot;hs_zsys_bp&quot;     
[5] &quot;hs_zdia_bp&quot;      &quot;hs_hypertensive&quot; &quot;hs_waist&quot;       

$Rhea
[1] &quot;HelixID&quot;         &quot;hs_bp_sys&quot;       &quot;hs_bp_dia&quot;       &quot;hs_zsys_bp&quot;     
[5] &quot;hs_zdia_bp&quot;      &quot;hs_hypertensive&quot; &quot;hs_waist&quot;       

$INMASAB
[1] &quot;HelixID&quot;         &quot;hs_bp_sys&quot;       &quot;hs_bp_dia&quot;       &quot;hs_zsys_bp&quot;     
[5] &quot;hs_zdia_bp&quot;      &quot;hs_hypertensive&quot; &quot;hs_waist&quot;       </code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="Exposome_HELIX_analysis.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Since the &quot;exposome_set&quot; object contains exposomeSet-type files for each cohort, the process for retrieving the names of variables is slightly different. For that purpose we have several functions from the _ds.ExposomeClient package_ called ds.phenotypeNames() and ds.exposome_variables(). #Get the name of the phenotypes available in the exposomeSet file for the EDEN cohort.</span></span>
<span id="cb17-2"><a href="Exposome_HELIX_analysis.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.phenotypeNames</span>(<span class="st">&quot;exposome_set&quot;</span>, conns)<span class="sc">$</span>EDEN</span></code></pre></div>
<pre><code> [1] &quot;.id.1&quot;                    &quot;.imp.1&quot;                  
 [3] &quot;HelixID&quot;                  &quot;SampleID&quot;                
 [5] &quot;hs_bmicat_None&quot;           &quot;hs_c_bmi_None&quot;           
 [7] &quot;hs_c_height_None&quot;         &quot;hs_c_weight_None&quot;        
 [9] &quot;hs_zheight_None&quot;          &quot;hs_zweight_None&quot;         
[11] &quot;hs_creatinine_c_None&quot;     &quot;hs_creatinine_cg_None&quot;   
[13] &quot;h_cereal_post_Log&quot;        &quot;h_dairy_post_Log&quot;        
[15] &quot;h_fastfood_post_Log&quot;      &quot;h_fish_post_Log&quot;         
[17] &quot;h_fruit_post_Log&quot;         &quot;h_legume_post_Log&quot;       
[19] &quot;h_meat_post_Log&quot;          &quot;h_nonalc_post_Log&quot;       
[21] &quot;h_sugar_post_Log&quot;         &quot;h_veg_post_Log&quot;          
[23] &quot;hs_child_age_days_None&quot;   &quot;hs_chol_cperc_None_v2&quot;   
[25] &quot;hs_hdlchol_c_None&quot;        &quot;hs_ldlchol_c_None&quot;       
[27] &quot;hs_phospho_c_None&quot;        &quot;hs_phospho_cperc_None_v2&quot;
[29] &quot;hs_totchol_c_None&quot;        &quot;hs_totfat_cperc_None_v2&quot; 
[31] &quot;hs_triglyc_c_None&quot;        &quot;hs_triglyc_cperc_None_v2&quot;
[33] &quot;hs_cmbl_None&quot;             &quot;hs_wifi_hm_None&quot;         
[35] &quot;h_nursery_Sqrt&quot;           &quot;h_nurseryage_None&quot;       
[37] &quot;h_solidfoods_None&quot;        &quot;h_ethnicity_c_None&quot;      
[39] &quot;hs_wrk_p5y_None&quot;          &quot;h_mbmi_None&quot;             
[41] &quot;h_mbmic_None&quot;             &quot;h_mheight_None&quot;          
[43] &quot;h_mweight_None&quot;           &quot;hs_wgtgain_None&quot;         
[45] &quot;e3_bwc_None&quot;              &quot;e3_gac_None&quot;             
[47] &quot;e3_pi_None&quot;               &quot;e3_premac_None&quot;          
[49] &quot;h_cesarean_None&quot;          &quot;h_spon_None&quot;             
[51] &quot;hs_creatinine_m_Log2&quot;     &quot;hs_creatinine_mg_Log2&quot;   
[53] &quot;e3_sex_None&quot;              &quot;e3_yearbir_None&quot;         
[55] &quot;h_age_None&quot;               &quot;h_cohort&quot;                
[57] &quot;h_edufc_None&quot;             &quot;h_edumc_None&quot;            
[59] &quot;h_native_None&quot;            &quot;h_parity_None&quot;           
[61] &quot;h_trimcon_None&quot;           &quot;hs_bf_None&quot;              
[63] &quot;hs_bfdur_Log&quot;             &quot;hs_chol_mperc_None_v2&quot;   
[65] &quot;hs_hdlchol_m_None&quot;        &quot;hs_ldlchol_m_None&quot;       
[67] &quot;hs_phospho_m_None&quot;        &quot;hs_phospho_mperc_None_v2&quot;
[69] &quot;hs_totchol_m_None&quot;        &quot;hs_totfat_mperc_None_v2&quot; 
[71] &quot;hs_triglyc_m_None&quot;        &quot;hs_triglyc_mperc_None_v2&quot;
[73] &quot;h_ivf_None&quot;               &quot;h_pdia_None&quot;             
[75] &quot;h_pecl_None&quot;              &quot;h_phta_None&quot;             
[77] &quot;h_crowding_None&quot;          &quot;h_fage_None&quot;             
[79] &quot;h_marital_None&quot;           &quot;h_mwork_None&quot;            
[81] &quot;h_urban_preg_None&quot;        &quot;hs_wrk_m_None&quot;           </code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="Exposome_HELIX_analysis.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the name of the exposures available in the exposomeSet file for the EDEN cohort.</span></span>
<span id="cb19-2"><a href="Exposome_HELIX_analysis.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_variables</span>(<span class="st">&quot;exposome_set&quot;</span> , <span class="at">target=</span><span class="st">&quot;exposures&quot;</span>)<span class="sc">$</span>EDEN</span></code></pre></div>
<pre><code>  [1] &quot;FAS_cat_None&quot;                &quot;h_Absorbance_Log&quot;           
  [3] &quot;h_Benzene_Log&quot;               &quot;h_bfdur_Ter&quot;                
  [5] &quot;h_NO2_Log&quot;                   &quot;h_PM_Log&quot;                   
  [7] &quot;h_TEX_Log&quot;                   &quot;hs_accesslines300_h_dic0&quot;   
  [9] &quot;hs_accesspoints300_h_Log&quot;    &quot;hs_as_c_Log2&quot;               
 [11] &quot;hs_bakery_prod_Ter&quot;          &quot;hs_beverages_Ter&quot;           
 [13] &quot;hs_blueyn300_h_None&quot;         &quot;hs_bpa_cadj_Log2&quot;           
 [15] &quot;hs_break_cer_Ter&quot;            &quot;hs_builtdens300_h_Sqrt&quot;     
 [17] &quot;hs_bupa_cadj_Log2&quot;           &quot;hs_caff_drink_Ter&quot;          
 [19] &quot;hs_cd_c_Log2&quot;                &quot;hs_co_c_Log2&quot;               
 [21] &quot;hs_connind300_h_Log&quot;         &quot;hs_contactfam_3cat_num_None&quot;
 [23] &quot;hs_cotinine_cdich_None&quot;      &quot;hs_cs_c_Log2&quot;               
 [25] &quot;hs_cu_c_Log2&quot;                &quot;hs_dairy_Ter&quot;               
 [27] &quot;hs_dde_cadj_Log2&quot;            &quot;hs_ddt_cadj_Log2&quot;           
 [29] &quot;hs_dep_cadj_Log2&quot;            &quot;hs_detp_cadj_Log2&quot;          
 [31] &quot;hs_distinvnear1_h_Log&quot;       &quot;hs_dmdtp_cdich_None&quot;        
 [33] &quot;hs_dmp_cadj_Log2&quot;            &quot;hs_dmtp_cadj_Log2&quot;          
 [35] &quot;hs_etpa_cadj_Log2&quot;           &quot;hs_fastfood_Ter&quot;            
 [37] &quot;hs_fdensity300_h_Log&quot;        &quot;hs_frichness300_h_None&quot;     
 [39] &quot;hs_globalexp2_None&quot;          &quot;hs_greenyn300_h_None&quot;       
 [41] &quot;hs_hcb_cadj_Log2&quot;            &quot;hs_hg_c_Log2&quot;               
 [43] &quot;hs_hm_pers_None&quot;             &quot;hs_hum_mt_hs_h_None&quot;        
 [45] &quot;hs_k_c_Log2&quot;                 &quot;hs_KIDMED_None&quot;             
 [47] &quot;hs_landuseshan300_h_None&quot;    &quot;hs_lden_cat_h_None&quot;         
 [49] &quot;hs_ln_cat_h_None&quot;            &quot;hs_mbzp_cadj_Log2&quot;          
 [51] &quot;hs_mecpp_cadj_Log2&quot;          &quot;hs_mehhp_cadj_Log2&quot;         
 [53] &quot;hs_mehp_cadj_Log2&quot;           &quot;hs_meohp_cadj_Log2&quot;         
 [55] &quot;hs_mep_cadj_Log2&quot;            &quot;hs_mepa_cadj_Log2&quot;          
 [57] &quot;hs_mg_c_Log2&quot;                &quot;hs_mibp_cadj_Log2&quot;          
 [59] &quot;hs_mn_c_Log2&quot;                &quot;hs_mnbp_cadj_Log2&quot;          
 [61] &quot;hs_mo_c_Log2&quot;                &quot;hs_mvpa_prd_alt_None&quot;       
 [63] &quot;hs_na_c_Log2&quot;                &quot;hs_ndvi100_h_None&quot;          
 [65] &quot;hs_no2_yr_hs_h_Log&quot;          &quot;hs_ohminp_cadj_Log2&quot;        
 [67] &quot;hs_org_food_Ter&quot;             &quot;hs_oxbe_cadj_Log2&quot;          
 [69] &quot;hs_oxominp_cadj_Log2&quot;        &quot;hs_participation_3cat_None&quot; 
 [71] &quot;hs_pb_c_Log2&quot;                &quot;hs_pbde153_cadj_Log2&quot;       
 [73] &quot;hs_pbde47_cadj_Log2&quot;         &quot;hs_pcb118_cadj_Log2&quot;        
 [75] &quot;hs_pcb138_cadj_Log2&quot;         &quot;hs_pcb153_cadj_Log2&quot;        
 [77] &quot;hs_pcb170_cadj_Log2&quot;         &quot;hs_pcb180_cadj_Log2&quot;        
 [79] &quot;hs_pet_cat_r2_None&quot;          &quot;hs_pet_dog_r2_None&quot;         
 [81] &quot;hs_pet_None&quot;                 &quot;hs_pfhxs_c_Log2&quot;            
 [83] &quot;hs_pfna_c_Log2&quot;              &quot;hs_pfoa_c_Log2&quot;             
 [85] &quot;hs_pfos_c_Log2&quot;              &quot;hs_pfunda_c_Log2&quot;           
 [87] &quot;hs_pm10_yr_hs_h_None&quot;        &quot;hs_pm25_yr_hs_h_None&quot;       
 [89] &quot;hs_pm25abs_yr_hs_h_Log&quot;      &quot;hs_popdens_h_Sqrt&quot;          
 [91] &quot;hs_proc_meat_Ter&quot;            &quot;hs_prpa_cadj_Log2&quot;          
 [93] &quot;hs_readymade_Ter&quot;            &quot;hs_sd_wk_None&quot;              
 [95] &quot;hs_se_c_Log2&quot;                &quot;hs_smk_parents_None&quot;        
 [97] &quot;hs_tl_cdich_None&quot;            &quot;hs_tm_mt_hs_h_None&quot;         
 [99] &quot;hs_total_bread_Ter&quot;          &quot;hs_total_cereal_Ter&quot;        
[101] &quot;hs_total_fish_Ter&quot;           &quot;hs_total_fruits_Ter&quot;        
[103] &quot;hs_total_lipids_Ter&quot;         &quot;hs_total_meat_Ter&quot;          
[105] &quot;hs_total_potatoes_Ter&quot;       &quot;hs_total_sweets_Ter&quot;        
[107] &quot;hs_total_veg_Ter&quot;            &quot;hs_total_yog_Ter&quot;           
[109] &quot;hs_trafload_h_pow1over3&quot;     &quot;hs_trafnear_h_pow1over3&quot;    
[111] &quot;hs_trcs_cadj_Log2&quot;           &quot;hs_uvdvf_mt_hs_h_None&quot;      
[113] &quot;hs_walkability_mean_h_None&quot;  &quot;hs_zn_c_Log2&quot;               
[115] &quot;PSS_4_Score_None&quot;           </code></pre>
<p>As we can observe from the previous descriptive, the <strong>number of individuals</strong> available in each of the cohort data.frames from the <strong>“pheno” object</strong> is <strong>different</strong> from the number of subjects available in each of the cohort <strong>exposomeSets</strong> from the <strong>“exposome_set” R object</strong>. To work only with a single <strong>exposomeSet</strong> file per <strong>cohort</strong>, we will now <strong>merge</strong> the additional phenotype data available in <strong>“pheno”</strong> to the outcomes already available in <strong>“exposome_set”</strong>. To do that, there is a function from the <strong>“dsExposomeClient”</strong> package called <em>ds.addPhenoData2ExposomeSet()</em>. This function add new phenotype data contained on a data.frame to an <strong>ExposomeSet</strong>. The <strong>ExposomeSet</strong> may or may not already have phenotype data. If the <strong>data.frame</strong> contains a phenotype already present on the <strong>ExposomeSet</strong>, the server function will throw an exception. The <strong>phenotypes data.frame</strong> has to contain an ID column which does not need to contain exactly the same individuals as the <strong>ExposomeSet</strong>, only the matching individuals will be updated, no new individuals will be introduced or removed from the <strong>ExposomeSet</strong>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="Exposome_HELIX_analysis.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We will employ the HelixID variable as the identifier to match subjects from each dataset.</span></span>
<span id="cb21-2"><a href="Exposome_HELIX_analysis.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.addPhenoData2ExposomeSet</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;pheno&quot;</span>, </span>
<span id="cb21-3"><a href="Exposome_HELIX_analysis.html#cb21-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">identifier_ExposomeSet =</span> <span class="st">&quot;HelixID&quot;</span>, </span>
<span id="cb21-4"><a href="Exposome_HELIX_analysis.html#cb21-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">identifier_new_phenotypes =</span> <span class="st">&quot;HelixID&quot;</span>)</span></code></pre></div>
<p>We can check the process has been conducted successfully by exploring the <strong>dimensions</strong> of the new <strong>exposomeSets files</strong> created per cohort.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="Exposome_HELIX_analysis.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.dim</span>(<span class="st">&quot;exposome_set&quot;</span>)</span></code></pre></div>
<pre><code>$`dimensions of exposome_set in BIB`
exposures   samples phenotyes 
      115       205        88 

$`dimensions of exposome_set in EDEN`
exposures   samples phenotyes 
      115       198        88 

$`dimensions of exposome_set in KANC`
exposures   samples phenotyes 
      115       204        88 

$`dimensions of exposome_set in MoBA`
exposures   samples phenotyes 
      115       272        88 

$`dimensions of exposome_set in Rhea`
exposures   samples phenotyes 
      115       199        88 

$`dimensions of exposome_set in INMASAB`
exposures   samples phenotyes 
      115       223        88 

$`dimensions of exposome_set in combined studies`
exposures   samples 
      690       205 </code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="Exposome_HELIX_analysis.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We can also check if there is metadata available in each expsomeSet file describing the families of exposomes.</span></span>
<span id="cb24-2"><a href="Exposome_HELIX_analysis.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.familyNames</span>(<span class="st">&quot;exposome_set&quot;</span>)</span></code></pre></div>
<pre><code>$BIB
 [1] &quot;Socio-eco capital_Fac&quot; &quot;Indoor air&quot;            &quot;Lifestyle&quot;            
 [4] &quot;Built Environment&quot;     &quot;Metals&quot;                &quot;Natural Spaces_fac&quot;   
 [7] &quot;Phenols&quot;               &quot;Cotinine&quot;              &quot;OCs&quot;                  
[10] &quot;OP Pesticides&quot;         &quot;Traffic&quot;               &quot;OP Pesticides_fac&quot;    
[13] &quot;Tobacco Smoke_fac&quot;     &quot;Socio-eco capital&quot;     &quot;Meteorological&quot;       
[16] &quot;Essential minerals&quot;    &quot;Noise_fac&quot;             &quot;Phthalates&quot;           
[19] &quot;Natural Spaces&quot;        &quot;Air Pollution&quot;         &quot;PBDEs&quot;                
[22] &quot;Lifestyle_fac&quot;         &quot;PFASs&quot;                

$EDEN
 [1] &quot;Socio-eco capital_Fac&quot; &quot;Indoor air&quot;            &quot;Lifestyle&quot;            
 [4] &quot;Built Environment&quot;     &quot;Metals&quot;                &quot;Natural Spaces_fac&quot;   
 [7] &quot;Phenols&quot;               &quot;Cotinine&quot;              &quot;OCs&quot;                  
[10] &quot;OP Pesticides&quot;         &quot;Traffic&quot;               &quot;OP Pesticides_fac&quot;    
[13] &quot;Tobacco Smoke_fac&quot;     &quot;Socio-eco capital&quot;     &quot;Meteorological&quot;       
[16] &quot;Essential minerals&quot;    &quot;Noise_fac&quot;             &quot;Phthalates&quot;           
[19] &quot;Natural Spaces&quot;        &quot;Air Pollution&quot;         &quot;PBDEs&quot;                
[22] &quot;Lifestyle_fac&quot;         &quot;PFASs&quot;                

$KANC
 [1] &quot;Socio-eco capital_Fac&quot; &quot;Indoor air&quot;            &quot;Lifestyle&quot;            
 [4] &quot;Built Environment&quot;     &quot;Metals&quot;                &quot;Natural Spaces_fac&quot;   
 [7] &quot;Phenols&quot;               &quot;Cotinine&quot;              &quot;OCs&quot;                  
[10] &quot;OP Pesticides&quot;         &quot;Traffic&quot;               &quot;OP Pesticides_fac&quot;    
[13] &quot;Tobacco Smoke_fac&quot;     &quot;Socio-eco capital&quot;     &quot;Meteorological&quot;       
[16] &quot;Essential minerals&quot;    &quot;Noise_fac&quot;             &quot;Phthalates&quot;           
[19] &quot;Natural Spaces&quot;        &quot;Air Pollution&quot;         &quot;PBDEs&quot;                
[22] &quot;Lifestyle_fac&quot;         &quot;PFASs&quot;                

$MoBA
 [1] &quot;Socio-eco capital_Fac&quot; &quot;Indoor air&quot;            &quot;Lifestyle&quot;            
 [4] &quot;Built Environment&quot;     &quot;Metals&quot;                &quot;Natural Spaces_fac&quot;   
 [7] &quot;Phenols&quot;               &quot;Cotinine&quot;              &quot;OCs&quot;                  
[10] &quot;OP Pesticides&quot;         &quot;Traffic&quot;               &quot;OP Pesticides_fac&quot;    
[13] &quot;Tobacco Smoke_fac&quot;     &quot;Socio-eco capital&quot;     &quot;Meteorological&quot;       
[16] &quot;Essential minerals&quot;    &quot;Noise_fac&quot;             &quot;Phthalates&quot;           
[19] &quot;Natural Spaces&quot;        &quot;Air Pollution&quot;         &quot;PBDEs&quot;                
[22] &quot;Lifestyle_fac&quot;         &quot;PFASs&quot;                

$Rhea
 [1] &quot;Socio-eco capital_Fac&quot; &quot;Indoor air&quot;            &quot;Lifestyle&quot;            
 [4] &quot;Built Environment&quot;     &quot;Metals&quot;                &quot;Natural Spaces_fac&quot;   
 [7] &quot;Phenols&quot;               &quot;Cotinine&quot;              &quot;OCs&quot;                  
[10] &quot;OP Pesticides&quot;         &quot;Traffic&quot;               &quot;OP Pesticides_fac&quot;    
[13] &quot;Tobacco Smoke_fac&quot;     &quot;Socio-eco capital&quot;     &quot;Meteorological&quot;       
[16] &quot;Essential minerals&quot;    &quot;Noise_fac&quot;             &quot;Phthalates&quot;           
[19] &quot;Natural Spaces&quot;        &quot;Air Pollution&quot;         &quot;PBDEs&quot;                
[22] &quot;Lifestyle_fac&quot;         &quot;PFASs&quot;                

$INMASAB
 [1] &quot;Socio-eco capital_Fac&quot; &quot;Indoor air&quot;            &quot;Lifestyle&quot;            
 [4] &quot;Built Environment&quot;     &quot;Metals&quot;                &quot;Natural Spaces_fac&quot;   
 [7] &quot;Phenols&quot;               &quot;Cotinine&quot;              &quot;OCs&quot;                  
[10] &quot;OP Pesticides&quot;         &quot;Traffic&quot;               &quot;OP Pesticides_fac&quot;    
[13] &quot;Tobacco Smoke_fac&quot;     &quot;Socio-eco capital&quot;     &quot;Meteorological&quot;       
[16] &quot;Essential minerals&quot;    &quot;Noise_fac&quot;             &quot;Phthalates&quot;           
[19] &quot;Natural Spaces&quot;        &quot;Air Pollution&quot;         &quot;PBDEs&quot;                
[22] &quot;Lifestyle_fac&quot;         &quot;PFASs&quot;                </code></pre>
</div>
<div id="implementation-of-exwas-in-datashield." class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Implementation of ExWAS in DataSHIELD.</h2>
<p>As we said, the main aim of this <strong>chapter</strong> is to illustrate how to perform <strong>exposome analyses</strong> on a <strong>multi-centre study</strong> in a non-disclosive way using <strong>DataSHIELD</strong>. In this subsection, we will cover how to apply <strong>Exposome Wide Association Analysis (ExWAS)</strong> in the prepared data from the <strong>HELIX</strong> project. For that, we will be reproducing some of the analyses conducted in <span class="citation">(<a href="#ref-WAREMBOURG20191317" role="doc-biblioref">Warembourg et al. 2019</a>)</span>, in which the association between a wide range of <strong>postnatal exposures</strong> and <strong>blood pressure (BP)</strong> phenotypes in children was investigated. In the <strong>childhood</strong> period, this work identified a <strong>bulk of external and internal exposures affecting</strong> both diastolic and systolic <strong>blood pressure</strong> measurements (<strong><em>Figure 1</em></strong>). Here, for simplification, we will <strong>replicate only some of the findings</strong> reported for <strong>systolic blood pressure</strong> (<strong>framed in red</strong> in the <strong><em>Figure 1</em></strong>). Particularly, we will focus in the study of exposures belonging to the family of <strong>“Organochlorine compounds (OCs)”</strong>.</p>
<br>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Figure1"></span>
<img src="fig/charline_Bp.png" alt="Figure 1. Environmental-Wide Association Study Between Postnatal Exposome and Systolic and Diastolic Blood Pressure in the HELIX cohort (Warembourg C et al. (2019)[@WAREMBOURG20191317]." width="90%" />
<p class="caption">
Figure 2.1: Figure 1. Environmental-Wide Association Study Between Postnatal Exposome and Systolic and Diastolic Blood Pressure in the HELIX cohort (Warembourg C et al. (2019)<span class="citation">(<a href="#ref-WAREMBOURG20191317" role="doc-biblioref">Warembourg et al. 2019</a>)</span>.
</p>
</div>
<p><br></p>
<p>The <strong>exact estimates and 95% confidence intervals (CIs)</strong> obtained for these <strong>exposures</strong> are presented in <a href="Exposome_HELIX_analysis.html#tab:tab1">2.1</a>. Importantly, these analyses were properly adjusted by <strong>confounders</strong> such as <strong>child age, child height, child sex, child cohort, mother’s age at the moment of birth, mother’s BMI at the moment of birth and paternal country of origin</strong>.</p>
<table>
<caption><span id="tab:tab1">Table 2.1: </span> Postnatal ExWAS and systolic and diastolic blood pressure (corrected p-value threshold=0.00068).</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Systolic Blood Pressure</th>
<th align="right">Diastolic Blood Pressure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Exposure</td>
<td align="right">Beta [95% CI]</td>
<td align="right">P-value</td>
</tr>
<tr class="even">
<td>—————————</td>
<td align="right">———————————-:</td>
<td align="right">———————————-:</td>
</tr>
<tr class="odd">
<td>DDE</td>
<td align="right">-2.1 [-2.92; -1.28]</td>
<td align="right"><strong>0.00000</strong></td>
</tr>
<tr class="even">
<td>HCB</td>
<td align="right">-2.05 [-2.82; -1.29]</td>
<td align="right"><strong>0.00000</strong></td>
</tr>
<tr class="odd">
<td>PCB 153</td>
<td align="right">-1.90 [-2.85; -0.95]</td>
<td align="right"><strong>0.00009</strong></td>
</tr>
<tr class="even">
<td>PCB 170</td>
<td align="right">-1.73 [-2.73; -0.73]</td>
<td align="right"><strong>0.00068</strong></td>
</tr>
<tr class="odd">
<td>PCBs (sum)</td>
<td align="right">-1.93 [-2.94; -0.92]</td>
<td align="right"><strong>0.00018</strong></td>
</tr>
</tbody>
</table>
<p>Before <strong>replicating these findings through ExWAS</strong>, it is advisable to extract some basic <strong>exploratory analysis</strong> on the <strong>outcome and confounders</strong> to be used in the models. For that, we can use the function <em>ds.exposome_summary()</em> from the package <strong>“ds.ExposomeClient”</strong>, which gives some basic summary statistics for both numeric and categorical variables.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="Exposome_HELIX_analysis.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve basic summary statistics for the main outcome under study (systolic blood pressure).</span></span>
<span id="cb26-2"><a href="Exposome_HELIX_analysis.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;hs_bp_sys&quot;</span>, conns)</span>
<span id="cb26-3"><a href="Exposome_HELIX_analysis.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="Exposome_HELIX_analysis.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve basic summary statistics for the confounders to be included in the model.</span></span>
<span id="cb26-5"><a href="Exposome_HELIX_analysis.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;hs_child_age_days_None&quot;</span>, conns)</span>
<span id="cb26-6"><a href="Exposome_HELIX_analysis.html#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;hs_c_height_None&quot;</span>, conns)</span>
<span id="cb26-7"><a href="Exposome_HELIX_analysis.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;e3_sex_None&quot;</span>, conns)</span>
<span id="cb26-8"><a href="Exposome_HELIX_analysis.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;h_cohort&quot;</span>, conns)</span>
<span id="cb26-9"><a href="Exposome_HELIX_analysis.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;h_age_None&quot;</span>, conns)</span>
<span id="cb26-10"><a href="Exposome_HELIX_analysis.html#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;h_mbmi_None&quot;</span>, conns)</span>
<span id="cb26-11"><a href="Exposome_HELIX_analysis.html#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposome_summary</span>(<span class="st">&quot;exposome_set&quot;</span>, <span class="st">&quot;h_native_None&quot;</span>, conns)</span></code></pre></div>
<p>From the previous chunk, we identify <strong>some problems</strong> with the variable <strong>parent’s country of origin</strong>, for which it seems there is no available data in some of the cohorts (<em>ERROR: “INVALID object!”</em>). Considering this, we will discard it from analysis, since it would give errors when incorporated into the models.</p>
<p>At this point, we are ready to <strong>apply the ExWAS</strong> on <strong>systolic blood pressure</strong> focusing in the particular set of <strong>exposures</strong> belonging the <strong>OCs family</strong>. For that, we have the <em>ds.exwas()</em> function from the <strong>“ds.ExposomeClient”</strong> package. As we will see, there are several <strong>ways</strong> of applying an <strong>ExWAS</strong> in <strong>DataSHIELD</strong> (<strong><em>pooled vs. meta</em></strong>), and the chosen method will depend on the characteristics of each project. Both methods are based on fitting different <strong>generalized linear models (GLMs)</strong> for each <strong>feature/exposure</strong> when assessing association with the <strong>phenotype of interest</strong>. The “virtually” <strong>pooled approach</strong> is recommended when the user wants to analyze data from different sources and obtain results as if the data were located in a <strong>single computer</strong>. It should be noticed that this method is not recommended when data are not properly harmonized or comparable between cohorts, whatever the reason. On the other hand, the federated <strong>meta-analysis approach</strong> performs an <strong>ExWAS on every study server</strong> to later <strong>meta-analyse</strong> the results. Thanks to that, it overcomes the limitations raised when performing pooled analysis.</p>
<p>In the next chunk of code, we present how to apply <strong>both types of ExWAS</strong> to the <strong>HELIX data</strong>. Since in our example, for simplification, we focused only on <strong>OCs exposures</strong>, it will be vital that our <strong>exposomeSets</strong> count on metadata as a description file. This will allow us to use the <strong>“exposure_family”</strong> argument, in the <em>ds.exwas()</em> function, in which we can indicate the family group of exposures to restrict our analysis to. Other arguments available in the <em>ds.exwas()</em> function include the <strong>“family”</strong> argument, which refers to the type of link function to be used in the GLM (e.g., gaussian for continuous outcomes, binary for binary outomes, or poisson for counts). It’s important to note that if the family argument does not match with the nature of the data available in the <strong>phenotype</strong>, the ExWAS will fail.</p>
<p>In the next chunk of code, we show how to apply ExWAS on our data following both approaches.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="Exposome_HELIX_analysis.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ExWAS with meta-analysis approach (without covariables). Estimated execution time: approx. 4.331925 mins</span></span>
<span id="cb27-2"><a href="Exposome_HELIX_analysis.html#cb27-2" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb27-3"><a href="Exposome_HELIX_analysis.html#cb27-3" aria-hidden="true" tabindex="-1"></a>res.meta <span class="ot">&lt;-</span> <span class="fu">ds.exwas</span>(<span class="st">&#39;hs_bp_sys ~ 1&#39;</span>, <span class="at">type =</span> <span class="st">&quot;meta&quot;</span>, </span>
<span id="cb27-4"><a href="Exposome_HELIX_analysis.html#cb27-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">exposures_family =</span> <span class="st">&quot;OCs&quot;</span>, </span>
<span id="cb27-5"><a href="Exposome_HELIX_analysis.html#cb27-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Set =</span> <span class="st">&#39;exposome_set&#39;</span>, <span class="at">family =</span> <span class="st">&#39;gaussian&#39;</span>)</span></code></pre></div>
<pre><code>[1] &quot;The computation of threshold for effective tests was not successful. NAs were generated on the correlation matrix so the calculation was aborted.&quot;</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="Exposome_HELIX_analysis.html#cb29-1" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb29-2"><a href="Exposome_HELIX_analysis.html#cb29-2" aria-hidden="true" tabindex="-1"></a>end_time <span class="sc">-</span> start_time</span></code></pre></div>
<pre><code>Time difference of 4.848315 mins</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="Exposome_HELIX_analysis.html#cb31-1" aria-hidden="true" tabindex="-1"></a>res.meta</span></code></pre></div>
<pre><code>$BIB
$BIB$exwas_results
             exposure family coefficient       minE       maxE    p.value
1    hs_dde_cadj_Log2    OCs  -1.6438877  -3.541887  0.2541115 0.08959152
2    hs_ddt_cadj_Log2    OCs   0.1091568  -2.060320  2.2786341 0.92144381
3    hs_hcb_cadj_Log2    OCs  -6.1180786 -13.452346  1.2161893 0.10205803
4 hs_pcb118_cadj_Log2    OCs  -7.1454343 -13.740344 -0.5505245 0.03370559
5 hs_pcb138_cadj_Log2    OCs  -2.8928741  -7.834245  2.0484967 0.25119960
6 hs_pcb153_cadj_Log2    OCs  -3.0742528  -8.365768  2.2172625 0.25483017
7 hs_pcb170_cadj_Log2    OCs  -2.4262873  -5.183666  0.3310918 0.08459568
8 hs_pcb180_cadj_Log2    OCs  -2.0223411  -4.891328  0.8466454 0.16710270

$BIB$alpha_corrected
[1] 0.0121022


$EDEN
$EDEN$exwas_results
             exposure family coefficient        minE      maxE    p.value
1    hs_dde_cadj_Log2    OCs  -0.4702087  -2.5559924  1.615575 0.65860175
2    hs_ddt_cadj_Log2    OCs   0.4009790  -0.6531102  1.455068 0.45592311
3    hs_hcb_cadj_Log2    OCs  -8.1803911 -14.4909796 -1.869803 0.01106328
4 hs_pcb118_cadj_Log2    OCs  -1.0977685  -3.8953491  1.699812 0.44184084
5 hs_pcb138_cadj_Log2    OCs  -1.1786063  -3.7056203  1.348408 0.36064718
6 hs_pcb153_cadj_Log2    OCs  -1.5515330  -4.1586353  1.055569 0.24344895
7 hs_pcb170_cadj_Log2    OCs  -0.3202816  -1.8331977  1.192635 0.67819988
8 hs_pcb180_cadj_Log2    OCs  -0.4135072  -1.8704955  1.043481 0.57803554

$EDEN$alpha_corrected
[1] 0.01384756


$KANC
$KANC$exwas_results
             exposure family coefficient      minE       maxE    p.value
1    hs_dde_cadj_Log2    OCs -2.15984812 -3.826289 -0.4934071 0.01107642
2    hs_ddt_cadj_Log2    OCs -0.01154892 -1.267423  1.2443256 0.98561997
3    hs_hcb_cadj_Log2    OCs -4.00761392 -7.181599 -0.8336290 0.01333342
4 hs_pcb118_cadj_Log2    OCs -2.80340364 -6.583489  0.9766814 0.14606908
5 hs_pcb138_cadj_Log2    OCs -2.63632131 -5.130332 -0.1423103 0.03828399
6 hs_pcb153_cadj_Log2    OCs -2.51562811 -4.823935 -0.2073216 0.03267949
7 hs_pcb170_cadj_Log2    OCs -1.29646005 -2.444243 -0.1486770 0.02683937
8 hs_pcb180_cadj_Log2    OCs -1.39850838 -2.563078 -0.2339385 0.01858855

$KANC$alpha_corrected
[1] 0.01553731


$MoBA
$MoBA$exwas_results
             exposure family coefficient      minE         maxE      p.value
1    hs_dde_cadj_Log2    OCs   -1.457757 -2.560167 -0.355347632 0.0095493749
2    hs_ddt_cadj_Log2    OCs   -1.148283 -2.292547 -0.004019784 0.0492005854
3    hs_hcb_cadj_Log2    OCs   -3.294045 -5.162940 -1.425149635 0.0005511926
4 hs_pcb118_cadj_Log2    OCs   -1.000168 -2.590214  0.589879201 0.2176309682
5 hs_pcb138_cadj_Log2    OCs   -1.934564 -3.410314 -0.458813747 0.0101898069
6 hs_pcb153_cadj_Log2    OCs   -2.542868 -4.252530 -0.833206050 0.0035551176
7 hs_pcb170_cadj_Log2    OCs   -1.505727 -2.548720 -0.462734545 0.0046617570
8 hs_pcb180_cadj_Log2    OCs   -1.958968 -3.183695 -0.734241512 0.0017185942

$MoBA$alpha_corrected
[1] 0.01209655


$Rhea
$Rhea$exwas_results
             exposure family coefficient      minE        maxE    p.value
1    hs_dde_cadj_Log2    OCs -1.05494477 -2.833861  0.72397135 0.24510916
2    hs_ddt_cadj_Log2    OCs -0.05756715 -1.260703  1.14556860 0.92528427
3    hs_hcb_cadj_Log2    OCs -5.14794959 -9.398718 -0.89718100 0.01761370
4 hs_pcb118_cadj_Log2    OCs -3.16975883 -6.312547 -0.02697095 0.04806604
5 hs_pcb138_cadj_Log2    OCs -2.41012750 -4.842452  0.02219693 0.05212769
6 hs_pcb153_cadj_Log2    OCs -2.34160066 -4.739251  0.05604920 0.05560145
7 hs_pcb170_cadj_Log2    OCs -0.59668424 -1.918566  0.72519716 0.37631391
8 hs_pcb180_cadj_Log2    OCs -0.85746219 -2.317065  0.60214090 0.24956546

$Rhea$alpha_corrected
[1] 0.01471134


$INMASAB
$INMASAB$exwas_results
             exposure family coefficient       minE       maxE      p.value
1    hs_dde_cadj_Log2    OCs  -2.1332539  -3.185178 -1.0813297 7.046300e-05
2    hs_ddt_cadj_Log2    OCs  -0.8714851  -1.875583  0.1326125 8.892252e-02
3    hs_hcb_cadj_Log2    OCs  -9.2905357 -13.492043 -5.0890284 1.464586e-05
4 hs_pcb118_cadj_Log2    OCs  -7.4019264 -12.284062 -2.5197910 2.963007e-03
5 hs_pcb138_cadj_Log2    OCs  -4.2831093  -7.150214 -1.4160047 3.412045e-03
6 hs_pcb153_cadj_Log2    OCs  -5.0169565  -8.169270 -1.8646428 1.812731e-03
7 hs_pcb170_cadj_Log2    OCs  -2.3555364  -3.846391 -0.8646819 1.956713e-03
8 hs_pcb180_cadj_Log2    OCs  -2.6446000  -4.294145 -0.9950553 1.676413e-03

$INMASAB$alpha_corrected
[1] 0.01400085


attr(,&quot;class&quot;)
[1] &quot;list&quot;         &quot;dsExWAS_meta&quot;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="Exposome_HELIX_analysis.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res.meta)</span></code></pre></div>
<pre><code>$BIB
$BIB$exwas_results
             exposure family coefficient       minE       maxE    p.value
1    hs_dde_cadj_Log2    OCs  -1.6438877  -3.541887  0.2541115 0.08959152
2    hs_ddt_cadj_Log2    OCs   0.1091568  -2.060320  2.2786341 0.92144381
3    hs_hcb_cadj_Log2    OCs  -6.1180786 -13.452346  1.2161893 0.10205803
4 hs_pcb118_cadj_Log2    OCs  -7.1454343 -13.740344 -0.5505245 0.03370559
5 hs_pcb138_cadj_Log2    OCs  -2.8928741  -7.834245  2.0484967 0.25119960
6 hs_pcb153_cadj_Log2    OCs  -3.0742528  -8.365768  2.2172625 0.25483017
7 hs_pcb170_cadj_Log2    OCs  -2.4262873  -5.183666  0.3310918 0.08459568
8 hs_pcb180_cadj_Log2    OCs  -2.0223411  -4.891328  0.8466454 0.16710270

$BIB$alpha_corrected
[1] 0.0121022


$EDEN
$EDEN$exwas_results
             exposure family coefficient        minE      maxE    p.value
1    hs_dde_cadj_Log2    OCs  -0.4702087  -2.5559924  1.615575 0.65860175
2    hs_ddt_cadj_Log2    OCs   0.4009790  -0.6531102  1.455068 0.45592311
3    hs_hcb_cadj_Log2    OCs  -8.1803911 -14.4909796 -1.869803 0.01106328
4 hs_pcb118_cadj_Log2    OCs  -1.0977685  -3.8953491  1.699812 0.44184084
5 hs_pcb138_cadj_Log2    OCs  -1.1786063  -3.7056203  1.348408 0.36064718
6 hs_pcb153_cadj_Log2    OCs  -1.5515330  -4.1586353  1.055569 0.24344895
7 hs_pcb170_cadj_Log2    OCs  -0.3202816  -1.8331977  1.192635 0.67819988
8 hs_pcb180_cadj_Log2    OCs  -0.4135072  -1.8704955  1.043481 0.57803554

$EDEN$alpha_corrected
[1] 0.01384756


$KANC
$KANC$exwas_results
             exposure family coefficient      minE       maxE    p.value
1    hs_dde_cadj_Log2    OCs -2.15984812 -3.826289 -0.4934071 0.01107642
2    hs_ddt_cadj_Log2    OCs -0.01154892 -1.267423  1.2443256 0.98561997
3    hs_hcb_cadj_Log2    OCs -4.00761392 -7.181599 -0.8336290 0.01333342
4 hs_pcb118_cadj_Log2    OCs -2.80340364 -6.583489  0.9766814 0.14606908
5 hs_pcb138_cadj_Log2    OCs -2.63632131 -5.130332 -0.1423103 0.03828399
6 hs_pcb153_cadj_Log2    OCs -2.51562811 -4.823935 -0.2073216 0.03267949
7 hs_pcb170_cadj_Log2    OCs -1.29646005 -2.444243 -0.1486770 0.02683937
8 hs_pcb180_cadj_Log2    OCs -1.39850838 -2.563078 -0.2339385 0.01858855

$KANC$alpha_corrected
[1] 0.01553731


$MoBA
$MoBA$exwas_results
             exposure family coefficient      minE         maxE      p.value
1    hs_dde_cadj_Log2    OCs   -1.457757 -2.560167 -0.355347632 0.0095493749
2    hs_ddt_cadj_Log2    OCs   -1.148283 -2.292547 -0.004019784 0.0492005854
3    hs_hcb_cadj_Log2    OCs   -3.294045 -5.162940 -1.425149635 0.0005511926
4 hs_pcb118_cadj_Log2    OCs   -1.000168 -2.590214  0.589879201 0.2176309682
5 hs_pcb138_cadj_Log2    OCs   -1.934564 -3.410314 -0.458813747 0.0101898069
6 hs_pcb153_cadj_Log2    OCs   -2.542868 -4.252530 -0.833206050 0.0035551176
7 hs_pcb170_cadj_Log2    OCs   -1.505727 -2.548720 -0.462734545 0.0046617570
8 hs_pcb180_cadj_Log2    OCs   -1.958968 -3.183695 -0.734241512 0.0017185942

$MoBA$alpha_corrected
[1] 0.01209655


$Rhea
$Rhea$exwas_results
             exposure family coefficient      minE        maxE    p.value
1    hs_dde_cadj_Log2    OCs -1.05494477 -2.833861  0.72397135 0.24510916
2    hs_ddt_cadj_Log2    OCs -0.05756715 -1.260703  1.14556860 0.92528427
3    hs_hcb_cadj_Log2    OCs -5.14794959 -9.398718 -0.89718100 0.01761370
4 hs_pcb118_cadj_Log2    OCs -3.16975883 -6.312547 -0.02697095 0.04806604
5 hs_pcb138_cadj_Log2    OCs -2.41012750 -4.842452  0.02219693 0.05212769
6 hs_pcb153_cadj_Log2    OCs -2.34160066 -4.739251  0.05604920 0.05560145
7 hs_pcb170_cadj_Log2    OCs -0.59668424 -1.918566  0.72519716 0.37631391
8 hs_pcb180_cadj_Log2    OCs -0.85746219 -2.317065  0.60214090 0.24956546

$Rhea$alpha_corrected
[1] 0.01471134


$INMASAB
$INMASAB$exwas_results
             exposure family coefficient       minE       maxE      p.value
1    hs_dde_cadj_Log2    OCs  -2.1332539  -3.185178 -1.0813297 7.046300e-05
2    hs_ddt_cadj_Log2    OCs  -0.8714851  -1.875583  0.1326125 8.892252e-02
3    hs_hcb_cadj_Log2    OCs  -9.2905357 -13.492043 -5.0890284 1.464586e-05
4 hs_pcb118_cadj_Log2    OCs  -7.4019264 -12.284062 -2.5197910 2.963007e-03
5 hs_pcb138_cadj_Log2    OCs  -4.2831093  -7.150214 -1.4160047 3.412045e-03
6 hs_pcb153_cadj_Log2    OCs  -5.0169565  -8.169270 -1.8646428 1.812731e-03
7 hs_pcb170_cadj_Log2    OCs  -2.3555364  -3.846391 -0.8646819 1.956713e-03
8 hs_pcb180_cadj_Log2    OCs  -2.6446000  -4.294145 -0.9950553 1.676413e-03

$INMASAB$alpha_corrected
[1] 0.01400085</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="Exposome_HELIX_analysis.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ExWAS with meta-analysis approachpooled approach (without covariables). Estimated execution time: approx. 4.218055 mins</span></span>
<span id="cb35-2"><a href="Exposome_HELIX_analysis.html#cb35-2" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb35-3"><a href="Exposome_HELIX_analysis.html#cb35-3" aria-hidden="true" tabindex="-1"></a>res.pooled <span class="ot">&lt;-</span> <span class="fu">ds.exwas</span>(<span class="st">&#39;hs_bp_sys ~ 1&#39;</span>, <span class="at">type =</span> <span class="st">&quot;pooled&quot;</span>, </span>
<span id="cb35-4"><a href="Exposome_HELIX_analysis.html#cb35-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">exposures_family =</span> <span class="st">&quot;OCs&quot;</span>, </span>
<span id="cb35-5"><a href="Exposome_HELIX_analysis.html#cb35-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Set =</span> <span class="st">&#39;exposome_set&#39;</span>, <span class="at">family =</span> <span class="st">&#39;gaussian&#39;</span>)</span></code></pre></div>
<pre><code>[1] &quot;The computation of threshold for effective tests was not successful. NAs were generated on the correlation matrix so the calculation was aborted.&quot;</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="Exposome_HELIX_analysis.html#cb37-1" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb37-2"><a href="Exposome_HELIX_analysis.html#cb37-2" aria-hidden="true" tabindex="-1"></a>end_time <span class="sc">-</span> start_time</span></code></pre></div>
<pre><code>Time difference of 4.871074 mins</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="Exposome_HELIX_analysis.html#cb39-1" aria-hidden="true" tabindex="-1"></a>res.pooled</span></code></pre></div>
<pre><code>$exwas_results
             exposure family coefficient      minE        maxE      p.value
1    hs_dde_cadj_Log2    OCs  -3.6203404 -4.173032 -3.06764924 9.976229e-38
2    hs_ddt_cadj_Log2    OCs  -2.0533429 -2.505415 -1.60127115 5.470142e-19
3    hs_hcb_cadj_Log2    OCs  -7.5606414 -8.702722 -6.41856079 1.694248e-38
4 hs_pcb118_cadj_Log2    OCs  -4.0522375 -5.209499 -2.89497594 6.744828e-12
5 hs_pcb138_cadj_Log2    OCs  -3.0908785 -4.079692 -2.10206552 8.980604e-10
6 hs_pcb153_cadj_Log2    OCs  -2.6037560 -3.655924 -1.55158813 1.233115e-06
7 hs_pcb170_cadj_Log2    OCs  -0.5434277 -1.107247  0.02039150 5.888131e-02
8 hs_pcb180_cadj_Log2    OCs  -0.5266027 -1.121772  0.06856693 8.288881e-02

$alpha_corrected
[1] 0.0121022

attr(,&quot;class&quot;)
[1] &quot;list&quot;           &quot;dsExWAS_pooled&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="Exposome_HELIX_analysis.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res.pooled)</span></code></pre></div>
<pre><code>$exwas_results
             exposure family coefficient      minE        maxE      p.value
1    hs_dde_cadj_Log2    OCs  -3.6203404 -4.173032 -3.06764924 9.976229e-38
2    hs_ddt_cadj_Log2    OCs  -2.0533429 -2.505415 -1.60127115 5.470142e-19
3    hs_hcb_cadj_Log2    OCs  -7.5606414 -8.702722 -6.41856079 1.694248e-38
4 hs_pcb118_cadj_Log2    OCs  -4.0522375 -5.209499 -2.89497594 6.744828e-12
5 hs_pcb138_cadj_Log2    OCs  -3.0908785 -4.079692 -2.10206552 8.980604e-10
6 hs_pcb153_cadj_Log2    OCs  -2.6037560 -3.655924 -1.55158813 1.233115e-06
7 hs_pcb170_cadj_Log2    OCs  -0.5434277 -1.107247  0.02039150 5.888131e-02
8 hs_pcb180_cadj_Log2    OCs  -0.5266027 -1.121772  0.06856693 8.288881e-02

$alpha_corrected
[1] 0.0121022</code></pre>
<p>As we said, these previous formulas will fit <strong>GLMs between the exposures and the phenotype</strong> as follows:</p>
<pre><code>    phenotype ~ exposure_1 + covar1 + ... + covarN
    phenotype ~ exposure_2 + covar1 + ... + covarN
    phenotype ~ exposure_3 + covar1 + ... + covarN
    ...
    phenotype ~ exposure_M + covar1 + ... + covarN</code></pre>
<p>The model is written as a string, where the left side term is the <strong>phenotype</strong>, and the right term are the <strong>covariates</strong> or <strong>confounders</strong> (e.g. variables to be adjusted for). A <strong>crude model</strong> is fitted in our example using <code>phenotype ~ 1</code>. In the case of having <strong>more covariates</strong> proceed as: <code>phenotype ~ cov1 + cov2 + ... + covN</code>.</p>
<p>To <strong>visualize the results</strong> from the <strong>ExWAS</strong>, the <strong>ds.ExposomeClient</strong> package has the function <em>ds.plotExwas()</em>. It takes the output of <em>ds.exwas()</em> and creates two different visualizations depending on the argument <strong>“type”</strong>. In the next chunk we show how to generate a <strong>Manhattan-like plot</strong> with the p-values of the association between each exposure and the outcome colored by families of exposures. The vertical red line stands for the significant level corrected by the effective number of tests.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="Exposome_HELIX_analysis.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One plot per cohort</span></span>
<span id="cb44-2"><a href="Exposome_HELIX_analysis.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.plotExwas</span>(res.meta, <span class="at">type=</span><span class="st">&quot;manhattan&quot;</span>)</span></code></pre></div>
<pre><code>$BIB</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_pvalues-1.png" width="960" /></p>
<pre><code>
$EDEN</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_pvalues-2.png" width="960" /></p>
<pre><code>
$KANC</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_pvalues-3.png" width="960" /></p>
<pre><code>
$MoBA</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_pvalues-4.png" width="960" /></p>
<pre><code>
$Rhea</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_pvalues-5.png" width="960" /></p>
<pre><code>
$INMASAB</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_pvalues-6.png" width="960" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="Exposome_HELIX_analysis.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One plot for the whole population</span></span>
<span id="cb51-2"><a href="Exposome_HELIX_analysis.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.plotExwas</span>(res.pooled, <span class="at">type=</span><span class="st">&quot;manhattan&quot;</span>)</span></code></pre></div>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_pvalues-7.png" width="960" /></p>
<p>Given the nature of the “Manhattan plots,” it should be noted that this kind of visualizations is more indicated when performing a big ExWAS study rather than when focusing in a group of exposures such is the present case.</p>
<p>We can also generate a <strong>plot showing the effects</strong> (beta values) and their <strong>confidence intervals</strong> with:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="Exposome_HELIX_analysis.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One plot per cohort</span></span>
<span id="cb52-2"><a href="Exposome_HELIX_analysis.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.plotExwas</span>(res.meta, <span class="at">type=</span><span class="st">&quot;effect&quot;</span>)</span></code></pre></div>
<pre><code>$BIB</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_effects-1.png" width="960" /></p>
<pre><code>
$EDEN</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_effects-2.png" width="960" /></p>
<pre><code>
$KANC</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_effects-3.png" width="960" /></p>
<pre><code>
$MoBA</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_effects-4.png" width="960" /></p>
<pre><code>
$Rhea</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_effects-5.png" width="960" /></p>
<pre><code>
$INMASAB</code></pre>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_effects-6.png" width="960" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="Exposome_HELIX_analysis.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One plot for the whole population</span></span>
<span id="cb59-2"><a href="Exposome_HELIX_analysis.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.plotExwas</span>(res.pooled, <span class="at">type=</span><span class="st">&quot;effect&quot;</span>)</span></code></pre></div>
<p><img src="OmicSHIELD_bookdown_files/figure-html/plot_effects-7.png" width="960" /></p>
<p>To replicate the findings from <span class="citation">(<a href="#ref-WAREMBOURG20191317" role="doc-biblioref">Warembourg et al. 2019</a>)</span>, we will next <strong>repeat the pooled ExWAS approach</strong> process but including all previously mentioned <strong>adjusting covariates</strong>, with the exception of the parent’s country of origin, which presented some problems as we saw during the descriptive inspection. As you can see, the order to adjust the models by cohort is given separately to the function, directly with the argument <strong>“adjust.by.study”</strong>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="Exposome_HELIX_analysis.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adjust by cohort and other covariates. Estimated execution time: approx. 5.670872 mins</span></span>
<span id="cb60-2"><a href="Exposome_HELIX_analysis.html#cb60-2" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb60-3"><a href="Exposome_HELIX_analysis.html#cb60-3" aria-hidden="true" tabindex="-1"></a>res.pooled_adjusted <span class="ot">&lt;-</span> <span class="fu">ds.exwas</span>(<span class="st">&quot;hs_bp_sys ~ hs_child_age_days_None + hs_c_height_None + e3_sex_None + h_age_None + h_mbmi_None&quot;</span>, <span class="at">type =</span> <span class="st">&quot;pooled&quot;</span>, </span>
<span id="cb60-4"><a href="Exposome_HELIX_analysis.html#cb60-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">adjust.by.study =</span> <span class="cn">TRUE</span>,</span>
<span id="cb60-5"><a href="Exposome_HELIX_analysis.html#cb60-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">exposures_family =</span> <span class="st">&quot;OCs&quot;</span>, </span>
<span id="cb60-6"><a href="Exposome_HELIX_analysis.html#cb60-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Set =</span> <span class="st">&quot;exposome_set&quot;</span>, <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb60-7"><a href="Exposome_HELIX_analysis.html#cb60-7" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb60-8"><a href="Exposome_HELIX_analysis.html#cb60-8" aria-hidden="true" tabindex="-1"></a>end_time <span class="sc">-</span> start_time</span>
<span id="cb60-9"><a href="Exposome_HELIX_analysis.html#cb60-9" aria-hidden="true" tabindex="-1"></a>res.pooled_adjusted</span></code></pre></div>
<p>As it can be seen, we are able to validate the main findings presented for the paper, reporting an <strong>inverse association</strong> between the serum concentration of some of these <strong>compounds</strong> and the <strong>systolic blood pressure</strong> levels of <strong>children</strong>.</p>
</div>
<div id="feature-selection-with-penalized-methods" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Feature selection with penalized methods</h2>
<p>In this subsection, we present how to perform <strong>variable selection</strong> with <strong>penalized regression methods</strong> in an exposome context. As previously mentioned, the <em>“dsMTL”</em> <strong>package</strong> allows the implementation of a <strong>federated version</strong> of conventional <strong>regularized regression techniques</strong> (such as Lasso, Ridge or Elastic-net), both in the context of continuous or binary outcomes (linear and logistic regression, respectively). Here, we will show how to apply these methods to the <strong>HELIX</strong> data, focusing in the <strong>systolic blood pressure</strong> of children as the main <strong>outcome</strong>.</p>
<p>Since most of the functions in the <em>“dsMTL”</em> <strong>package</strong> require data of each cohort to be passed as <strong>separate matrices</strong> for the predictors and the outcome, in the next chunks of code we will show how to transform the input <strong>HELIX</strong> dataset from the current <strong>exposomeSet</strong> format into two <strong>matrices</strong> with the required format in <strong>DataSHIELD</strong>. For that, we will start generating two <strong>data.frames</strong>, one for <strong>exposure data</strong> and one for the <strong>outcome data</strong>.</p>
<p>First, we will use the function <em>ds.exposures_pData()</em>, which can extracts exposures, phenotypes or combined data and saves it to a data frame on the server side.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="Exposome_HELIX_analysis.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#With the &quot;name&quot; argument, we can specify the name of the new R object to be created, if no name argument is provided, the new object will be named &quot;set_table&quot; where &quot;set&quot; is the inputted argument.</span></span>
<span id="cb61-2"><a href="Exposome_HELIX_analysis.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposures_pData</span>(<span class="st">&#39;exposome_set&#39;</span>,  </span>
<span id="cb61-3"><a href="Exposome_HELIX_analysis.html#cb61-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">&quot;exposures&quot;</span>, <span class="at">exposures_type =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb61-4"><a href="Exposome_HELIX_analysis.html#cb61-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">name =</span> <span class="st">&#39;table_exposures&#39;</span>)</span>
<span id="cb61-5"><a href="Exposome_HELIX_analysis.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.exposures_pData</span>(<span class="st">&#39;exposome_set&#39;</span>,  </span>
<span id="cb61-6"><a href="Exposome_HELIX_analysis.html#cb61-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">&quot;phenotypes&quot;</span>, <span class="at">exposures_type =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb61-7"><a href="Exposome_HELIX_analysis.html#cb61-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">name =</span> <span class="st">&#39;table_phenotypes&#39;</span>)</span>
<span id="cb61-8"><a href="Exposome_HELIX_analysis.html#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="Exposome_HELIX_analysis.html#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#we can check the objects created in the remote session for each cohort by typing</span></span>
<span id="cb61-10"><a href="Exposome_HELIX_analysis.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.ls</span>()</span></code></pre></div>
<p>Now we have two <strong>different objects</strong> for <strong>exposures</strong> and <strong>phenotype data</strong>, we can continue with the data preparation.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="Exposome_HELIX_analysis.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We start by assigning the outcome Systolic Blood pressure to a new R object of the type numeric vector called &quot;Y&quot; in the server side.</span></span>
<span id="cb62-2"><a href="Exposome_HELIX_analysis.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.assign</span>(<span class="at">toAssign=</span><span class="st">&quot;table_phenotypes$hs_bp_sys&quot;</span>, <span class="at">newobj=</span><span class="st">&quot;Y&quot;</span>, <span class="at">datasources =</span> conns)</span>
<span id="cb62-3"><a href="Exposome_HELIX_analysis.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if there is NA values in the phenotype.</span></span>
<span id="cb62-4"><a href="Exposome_HELIX_analysis.html#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.numNA</span>(<span class="st">&quot;Y&quot;</span>)</span>
<span id="cb62-5"><a href="Exposome_HELIX_analysis.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NA values by the cohort mean.</span></span>
<span id="cb62-6"><a href="Exposome_HELIX_analysis.html#cb62-6" aria-hidden="true" tabindex="-1"></a>Y_means <span class="ot">&lt;-</span> <span class="fu">ds.mean</span>(<span class="at">x =</span> <span class="st">&quot;Y&quot;</span>,<span class="at">type =</span> <span class="st">&quot;split&quot;</span>,<span class="at">save.mean.Nvalid =</span> F,<span class="at">datasources =</span> conns)<span class="sc">$</span>Mean.by.Study</span>
<span id="cb62-7"><a href="Exposome_HELIX_analysis.html#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.replaceNA</span>(<span class="at">x =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">forNA =</span> Y_means[,<span class="dv">1</span>], <span class="at">newobj =</span> <span class="st">&quot;Y_imp&quot;</span>, <span class="at">datasources =</span> conns)</span>
<span id="cb62-8"><a href="Exposome_HELIX_analysis.html#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="Exposome_HELIX_analysis.html#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We extract the adjusting covariates from the phenotype dataset and assign them to a new dataframe names &quot;X_confounders&quot;</span></span>
<span id="cb62-10"><a href="Exposome_HELIX_analysis.html#cb62-10" aria-hidden="true" tabindex="-1"></a>keep_conf <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">ds.colnames</span>(<span class="st">&#39;table_phenotypes&#39;</span>)[[<span class="dv">1</span>]] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;hs_child_age_days_None&quot;</span>,<span class="st">&quot;hs_c_height_None&quot;</span>,<span class="st">&quot;e3_sex_None&quot;</span>,<span class="st">&quot;h_age_None&quot;</span>,<span class="st">&quot;h_mbmi_None&quot;</span>))</span>
<span id="cb62-11"><a href="Exposome_HELIX_analysis.html#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.dataFrameSubset</span>(<span class="at">df.name =</span> <span class="st">&quot;table_phenotypes&quot;</span>,  <span class="at">V1.name =</span> <span class="cn">NULL</span>,  <span class="at">V2.name =</span> <span class="cn">NULL</span>,  <span class="at">Boolean.operator =</span> <span class="cn">NULL</span>,<span class="at">keep.cols =</span> keep_conf,  <span class="at">rm.cols =</span> <span class="cn">NULL</span>,  <span class="at">keep.NAs =</span> <span class="cn">NULL</span>,  <span class="at">newobj =</span> <span class="st">&quot;X_confounders&quot;</span>,  <span class="at">datasources =</span> conns, <span class="at">notify.of.progress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-12"><a href="Exposome_HELIX_analysis.html#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="Exposome_HELIX_analysis.html#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We merge confounders data with exposures and assign the result to an R object calles &quot;X&quot;.</span></span>
<span id="cb62-14"><a href="Exposome_HELIX_analysis.html#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.dataFrame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;table_exposures&quot;</span>,<span class="st">&quot;X_confounders&quot;</span>), <span class="at">completeCases =</span> <span class="cn">TRUE</span>, <span class="at">newobj =</span> <span class="st">&quot;X&quot;</span>, <span class="at">datasources =</span> conns) </span>
<span id="cb62-15"><a href="Exposome_HELIX_analysis.html#cb62-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-16"><a href="Exposome_HELIX_analysis.html#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co"># We again check dimensions and attribute names for the resulting objects.</span></span>
<span id="cb62-17"><a href="Exposome_HELIX_analysis.html#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.dim</span>(<span class="st">&quot;X&quot;</span>)</span>
<span id="cb62-18"><a href="Exposome_HELIX_analysis.html#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.class</span>(<span class="st">&quot;Y&quot;</span>)</span>
<span id="cb62-19"><a href="Exposome_HELIX_analysis.html#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.length</span>(<span class="st">&quot;Y&quot;</span>)</span>
<span id="cb62-20"><a href="Exposome_HELIX_analysis.html#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.colnames</span>(<span class="st">&quot;X&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb62-21"><a href="Exposome_HELIX_analysis.html#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="Exposome_HELIX_analysis.html#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co"># We coerce both Xs and Y into matrices. </span></span>
<span id="cb62-23"><a href="Exposome_HELIX_analysis.html#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co">#ds.asMatrix(x.name = &quot;Y&quot;, newobj = &quot;Y&quot;, datasources = NULL)</span></span>
<span id="cb62-24"><a href="Exposome_HELIX_analysis.html#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asMatrix</span>(<span class="at">x.name =</span> <span class="st">&quot;table_exposures&quot;</span>, <span class="at">newobj =</span> <span class="st">&quot;X&quot;</span>, <span class="at">datasources =</span> <span class="cn">NULL</span>)</span>
<span id="cb62-25"><a href="Exposome_HELIX_analysis.html#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asMatrix</span>(<span class="at">x.name =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">newobj =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">datasources =</span> <span class="cn">NULL</span>)</span>
<span id="cb62-26"><a href="Exposome_HELIX_analysis.html#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asMatrix</span>(<span class="at">x.name =</span> <span class="st">&quot;Y_imp&quot;</span>, <span class="at">newobj =</span> <span class="st">&quot;Y_imp&quot;</span>, <span class="at">datasources =</span> <span class="cn">NULL</span>)</span>
<span id="cb62-27"><a href="Exposome_HELIX_analysis.html#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co"># We assign both matrices to R objects in the client-side.</span></span>
<span id="cb62-28"><a href="Exposome_HELIX_analysis.html#cb62-28" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="st">&quot;X&quot;</span>; Y<span class="ot">=</span><span class="st">&quot;Y&quot;</span>; Y_imp<span class="ot">=</span><span class="st">&quot;Y_imp&quot;</span></span></code></pre></div>
<p>Once we have the data in the right format, we can proceed to perform variable selection with penalized methods. <strong>Available functions</strong> in the package for such purpose include:</p>
<ul>
<li><em>ds.LS_Lasso()</em>: Solver of <strong>regression with Lasso</strong>.</li>
<li><em>ds.LR_Lasso()</em>: Solver of <strong>logistic regression</strong> with <strong>Lasso</strong>.<br />
</li>
<li><em>ds.Lasso_Train()</em>: Train a <strong>regularization tree</strong> with <strong>Lasso</strong> for a <strong>sequence of penalty values</strong> (than can be either provided by the user, or directly estimated from the data).</li>
<li><em>ds.Lasso_CVInSite()</em>: In-site <strong>cross-validation</strong> procedure for <strong>selecting the optimal penalty</strong>.</li>
</ul>
<p>In all these functions, there is an argument called <strong>“<em>C</em>”</strong>, which is the <strong>hyperparameter</strong> for the <strong>Ridge</strong> regression L2 penalty. Thus, by tuning both the L1 penalty and the C argument (L2 term), one would be able to chose between a <strong>Lasso</strong>, <strong>Ridge</strong> or <strong>Elastic-Net regression</strong>. Likewise, there is an argument called <strong>“<em>opts</em>”</strong>, which allow controlling the optimization algorithm employed to minimize the sum of squared errors (SSE) (<strong>objective function</strong>). Additional details regarding the loss function implemented in these models can be found in the supplementary material of <span class="citation">(<a href="#ref-Cao2021.08.26.457778" role="doc-biblioref"><strong>Cao2021.08.26.457778?</strong></a>)</span>. Within the <strong>“<em>opts</em>”</strong> argument we find:</p>
<ul>
<li><p><strong>“init”</strong>: It determines the starting point.</p></li>
<li><p><strong>“maxIter”</strong>: It is the maximized iteration number.</p></li>
<li><p><strong>“ter”</strong>: It refers to the termination rule used to determine the convergence of the algorithm. There are three termination rules available for <em>ds.lasso</em>. The first rule checks whether the current objective value was close enough to 0. The second rule investigates the last two objective values and checks whether the decline was close enough to 0. The third rule allowed the optimization to be performed for a certain maximum number of iterations.</p></li>
<li><p><strong>“tol”</strong>: It refers to the precision of the convergence and determines the termination of the program.</p></li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="Exposome_HELIX_analysis.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Default values for the opts argument.</span></span>
<span id="cb63-2"><a href="Exposome_HELIX_analysis.html#cb63-2" aria-hidden="true" tabindex="-1"></a>opts<span class="ot">=</span><span class="fu">list</span>();opts<span class="sc">$</span>init<span class="ot">=</span><span class="dv">0</span>; opts<span class="sc">$</span>maxIter<span class="ot">=</span><span class="dv">10</span>; opts<span class="sc">$</span>tol<span class="ot">=</span><span class="fl">0.01</span>; opts<span class="sc">$</span>ter<span class="ot">=</span><span class="dv">2</span>;</span></code></pre></div>
<p>A <strong>summary</strong> of the <strong>whole pipeline</strong> that one could follow in <strong>DataSHIELD</strong> for performing <strong>feature selection</strong> with <strong>Lasso regression</strong> can be found in (<strong><em>Figure 2</em></strong>).</p>
<br>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Figure2"></span>
<img src="fig/dslasso.jpg" alt="Figure 2. DataSHIELD for the implementation of penalized Lasso regression in a federated framework." width="90%" />
<p class="caption">
Figure 2.2: Figure 2. DataSHIELD for the implementation of penalized Lasso regression in a federated framework.
</p>
</div>
<p><br></p>
<div id="ds.ls_lasso-function." class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> <em>ds.LS_Lasso()</em> function.</h3>
<p>With the <em>ds.LS_Lasso()</em> function, we can apply the lasso solver of regression for a <strong>particular</strong> value of the <strong>lambda</strong> penalty. <strong>Input</strong> arguments available in the function include:</p>
<ul>
<li><em>X</em>: The design matrices of multiple cohorts.</li>
<li><em>Y</em>: Label vectors of multiple cohorts.</li>
<li><em>lam</em>: Input lambda value.</li>
<li><em>C</em>: The hyper-parameter associated with L2 term.</li>
<li><em>opts</em>: Options controlling the optimization procedure.</li>
<li><em>datasources</em>: The connections of servers.</li>
<li><em>nDigits</em>: The number of digits rounded for each number prepared for network transmission.</li>
<li><em>W</em>: The current estimate of the variables (if available).</li>
</ul>
<p><strong><em>Note that if we set lam=0 and C&gt;0 we will do Ridge regression, lam&gt;0 and C=0 we will do Lasso, while any other combination of these both will be Elastic-Net.</em></strong></p>
<p>The <strong>output</strong> of this function comprises:</p>
<ul>
<li>The <strong>vector of weights</strong> estimated for input <strong>predictors</strong>.</li>
<li>The converged result of optimization.</li>
<li>The proximal point of W and the non-smooth part of objective.</li>
</ul>
<p>In the next chunk, we apply this function to our <strong>example dataset</strong>, setting the value of the <strong>lambda penalty</strong> to “0.5.” For this, we will test the association between the <strong>174 predictors</strong> and the continuous outcome <strong>BMI Z-Score</strong>. In case we were interested in modeling a <strong>binary outcome</strong>, we should use the <em>ds.LR_Lasso()</em> function instead, which share exactly the same arguments and options.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="Exposome_HELIX_analysis.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated execution time: approx. 17.05 seconds.</span></span>
<span id="cb64-2"><a href="Exposome_HELIX_analysis.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb64-3"><a href="Exposome_HELIX_analysis.html#cb64-3" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">=</span><span class="fu">ds.LS_Lasso</span>(<span class="at">X=</span>X, <span class="at">Y=</span>Y_imp, <span class="at">lam=</span><span class="fl">0.5</span>, <span class="at">C=</span><span class="dv">0</span>, opts, <span class="at">datasources=</span>conns, <span class="at">nDigits=</span><span class="dv">15</span>)</span>
<span id="cb64-4"><a href="Exposome_HELIX_analysis.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the number of selected variables by the model for the assessed lambda</span></span>
<span id="cb64-5"><a href="Exposome_HELIX_analysis.html#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(m1<span class="sc">$</span>w<span class="sc">!=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>[1] 79</code></pre>
<p>In our example, with this <strong>lambda penalty</strong>, <strong>79 variables</strong> are selected as significant contributors to the outcome <strong>systolic blood pressure</strong>. Now, we can <strong>plot</strong> estimated coefficients from the model.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="Exposome_HELIX_analysis.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1<span class="sc">$</span>w, <span class="at">xlab=</span><span class="st">&quot;index of coefficients&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;values&quot;</span>)</span></code></pre></div>
<p><img src="OmicSHIELD_bookdown_files/figure-html/analysis_3-1.png" width="672" /></p>
<p>Please, note that input variables are not standardized previous to the modeling in <em>ds.LS_Lasso()</em>, while, in the local solution <em>glmnet()</em>, the default argument is <em>standardize=TRUE</em>.</p>
</div>
<div id="ds.lasso_train-function." class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> <em>ds.Lasso_Train()</em> function.</h3>
<p>Instead of introducing a single value of lambda and fitting the model, a <strong>whole lambda sequence</strong> can be tested (either if it has been <strong>defined by the user</strong>, or if it has been <strong>estimated from the data</strong>). For that purpose, we must use the function <em>ds.Lasso_Train()</em>, which trains a whole <strong>regularization tree</strong> with <strong>Lasso</strong> for a <strong>set</strong> of <strong>penalty values</strong>.</p>
<p>Some <strong>input</strong> arguments available here and not present in the previous function are:</p>
<ul>
<li><p><em>type</em>: Regression(=regress) or classification(=classify).</p></li>
<li><p><em>nlambda</em>: The length of lambda sequence.</p></li>
<li><p><em>lam_ratio</em>: This is an option affecting how the lambda sequence is extracted from the data. It refers to the ratio: <span class="math inline">\(min(lambda) / max(lambda)\)</span>.</p></li>
<li><p><em>lambda</em>: The lambda sequence.</p></li>
<li><p><em>intercept</em>: Use intercept(=TRUE) or non-intercept(=FALSE) model.</p></li>
</ul>
<p>The process of <strong>lambdas estimation from the data</strong> in this function is governed by two arguments: <em>“nlambda”</em> and <em>“lam_ratio”</em>. First, the <strong>lambda max</strong> is determined as the smallest value of lambda for which no parameters are selected. In the next chunk, we show the code lines of the function source code that extract the <strong>lambda max</strong> value from the data.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="Exposome_HELIX_analysis.html#cb67-1" aria-hidden="true" tabindex="-1"></a>xys <span class="ot">=</span> DSI<span class="sc">::</span><span class="fu">datashield.aggregate</span>(datasources, <span class="fu">call</span>(<span class="st">&quot;xtyDS&quot;</span>, X, Y)) <span class="co">#matrix multiplication x * t(y) </span></span>
<span id="cb67-2"><a href="Exposome_HELIX_analysis.html#cb67-2" aria-hidden="true" tabindex="-1"></a>xys <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="fu">do.call</span>(cbind, xys))<span class="sc">/</span><span class="fu">sum</span>(nSubs)</span>
<span id="cb67-3"><a href="Exposome_HELIX_analysis.html#cb67-3" aria-hidden="true" tabindex="-1"></a>xy_norm <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">abs</span>(xys))</span></code></pre></div>
<p>The determination of <strong>λmin</strong> and the number of grid points seems less principled. The <strong>λmin</strong> is calculated as <span class="math inline">\(λmin=λratio∗λmax\)</span>, and then a grid of <em>n</em> equally spaced points on the logarithmic scale between <strong>λmin</strong> and <strong>λmax</strong> is generated.</p>
<p>The <strong>output</strong> of the <em>ds.Lasso_Train()</em> function is a list composed of:</p>
<ul>
<li>A <strong>matrix</strong> with as many columns as lambdas and as many rows as variables including the <strong>estimated coefficients</strong> for each variable-lambda.^</li>
<li>A vector with the <strong>sequence of lambdas</strong> (either if they were estimated from data or introduced by the user).</li>
</ul>
<p>Next, we show how to apply this function to our <strong>case study</strong>, estimating a <strong>sequence of 4 lambda penalties</strong> from the data.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="Exposome_HELIX_analysis.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated execution time: approx. 56.79 seconds.</span></span>
<span id="cb68-2"><a href="Exposome_HELIX_analysis.html#cb68-2" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">=</span><span class="fu">ds.Lasso_Train</span>(<span class="at">X=</span>X, <span class="at">Y=</span>Y_imp, <span class="at">type=</span><span class="st">&quot;regress&quot;</span>, <span class="at">nlambda=</span><span class="dv">4</span>, <span class="at">lam_ratio=</span><span class="fl">0.0001</span>, <span class="at">C=</span><span class="dv">0</span>, <span class="at">opts=</span>opts,<span class="at">datasources=</span>conns, <span class="at">nDigits=</span><span class="dv">15</span>)</span>
<span id="cb68-3"><a href="Exposome_HELIX_analysis.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(m2)</span></code></pre></div>
<pre><code>List of 6
 $ ws     : num [1:79, 1:4] 0 0 0 0 0 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:4] &quot;Lam=38347.3&quot; &quot;Lam=1779.92&quot; &quot;Lam=82.62&quot; &quot;Lam=3.83&quot;
 $ Logs   : num [1:4, 1:2] 1 5 3 3 1 23 21 21
 $ Obj    : num [1:12] 5027 1142 1089 1060 1033 ...
 $ gamma  : num [1:4] 1 262144 262144 262144
 $ type   : chr &quot;regress&quot;
 $ lam_seq: num [1:4] 38347.3 1779.92 82.62 3.83</code></pre>
<p>From the output of this function, the <strong>number of selected variables</strong> for each lambda value can also be extracted:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="Exposome_HELIX_analysis.html#cb70-1" aria-hidden="true" tabindex="-1"></a>fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">length</span>(<span class="fu">which</span>(x <span class="sc">!=</span> <span class="dv">0</span>)) }</span>
<span id="cb70-2"><a href="Exposome_HELIX_analysis.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m2<span class="sc">$</span>ws,<span class="dv">2</span>,fun)</span></code></pre></div>
<pre><code>Lam=38347.3 Lam=1779.92   Lam=82.62    Lam=3.83 
          1           3          15          75 </code></pre>
<p>And we can plot the results (<strong>regularization tree</strong>). If the estimation of the <strong>λmax</strong> penalty has been performed correctly, all horizontal lines in the plot should begin with <em>w=0</em>, since, as we said before, by definition, the <strong>λmax</strong> is the smallest value of lambda for which no parameters are selected.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="Exposome_HELIX_analysis.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(<span class="fu">t</span>(m2<span class="sc">$</span>ws), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main=</span><span class="st">&quot;solution Path&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;coefficients&quot;</span>)</span></code></pre></div>
<p><img src="OmicSHIELD_bookdown_files/figure-html/analysis_7-1.png" width="672" /></p>
<p><em>Please, note that the values in the <strong>X</strong> axis refer to the appearance order of each lambda in the lambda sequence vector, i.e., Lam1=38347.3, Lam2=1779.92, Lam3=82.62 and Lam4=3.83</em></p>
<p>In the case of the <strong>lambda sequence</strong> is <strong>defined by the user</strong>, we would have:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="Exposome_HELIX_analysis.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated execution time: approx. 36.23 seconds.</span></span>
<span id="cb73-2"><a href="Exposome_HELIX_analysis.html#cb73-2" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">=</span><span class="fu">ds.Lasso_Train</span>(<span class="at">X=</span>X, <span class="at">Y=</span>Y_imp, <span class="at">type=</span><span class="st">&quot;regress&quot;</span>, <span class="at">nlambda=</span><span class="dv">2</span>, <span class="at">lambda=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.6</span>), <span class="at">C=</span><span class="dv">0</span>, <span class="at">opts=</span>opts,<span class="at">datasources=</span>conns, <span class="at">nDigits=</span><span class="dv">15</span>)</span>
<span id="cb73-3"><a href="Exposome_HELIX_analysis.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Show number of selected variables and plot coefficients.</span></span>
<span id="cb73-4"><a href="Exposome_HELIX_analysis.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m3<span class="sc">$</span>ws,<span class="dv">2</span>,fun)</span></code></pre></div>
<pre><code>Lam=0.2 Lam=0.6 
     79      78 </code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="Exposome_HELIX_analysis.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(<span class="fu">t</span>(m3<span class="sc">$</span>ws), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main=</span><span class="st">&quot;solution Path&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;coefficients&quot;</span>)</span></code></pre></div>
<p><img src="OmicSHIELD_bookdown_files/figure-html/analysis_8-1.png" width="672" /></p>
<p>An <strong>important drawback</strong> of the current version of the <em>ds.Lasso_Train()</em> function, is that it <strong>does not allow to force the inclusion of covariates in models</strong>, which in <em>glmnet()</em> is achieved through the argument <em>“penalty.factor”</em> by reducing to 0 the penalty to be applied to their coefficients. Other <strong>important difference</strong> is the type of <strong>optimization algorithm</strong> employed for the estimation of coefficients. In comparison to <em>glmnet()</em>, which implements the coordinate descent <span class="citation">(<a href="#ref-Wright2015" role="doc-biblioref"><strong>Wright2015?</strong></a>)</span>, <em>ds.Lasso_Train()</em> implements an optimization procedure based on the proximal algorithm framework <span class="citation">(<a href="#ref-OPT-003" role="doc-biblioref"><strong>OPT-003?</strong></a>)</span>.</p>
</div>
<div id="ds.lasso_cvinsite-function." class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> <em>ds.Lasso_CVInSite()</em> function.</h3>
<p>As in <em>glmnet()</em>, <em>ds.Lasso</em> also allows the selection of the <strong>optimal lambda</strong> by a <strong>k-fold cross-validation procedure</strong>. This is done in <em>“dsMTL”</em> with the function <em>ds.Lasso_CVInSite()</em>, which has practically the same arguments than previous functions, except for the <em>“nfolds”</em> argument, referring to the number of folds for the CV procedure.</p>
<p>From the application of this function to our <strong>case study</strong>, we can estimate a lambda sequence of 5 values with a 5-fold CV procedure:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="Exposome_HELIX_analysis.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#NOT DEFINITIVE</span></span>
<span id="cb76-2"><a href="Exposome_HELIX_analysis.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated execution time: approx. 8.17 mins.</span></span>
<span id="cb76-3"><a href="Exposome_HELIX_analysis.html#cb76-3" aria-hidden="true" tabindex="-1"></a>cvResult<span class="ot">=</span><span class="fu">ds.Lasso_CVInSite</span>(<span class="at">X=</span>X, <span class="at">Y=</span>Y_imp, <span class="at">type=</span><span class="st">&quot;regress&quot;</span>, <span class="at">lam_ratio=</span><span class="fl">0.5</span>, <span class="at">nlambda=</span><span class="dv">5</span>, <span class="at">opts=</span>opts, <span class="at">C=</span><span class="dv">0</span>, <span class="at">datasources=</span>conns, <span class="at">nDigits=</span><span class="dv">4</span>, <span class="at">nfolds=</span><span class="dv">10</span>)</span>
<span id="cb76-4"><a href="Exposome_HELIX_analysis.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot showing the averaged MSE obtained for lambda values over folds</span></span>
<span id="cb76-5"><a href="Exposome_HELIX_analysis.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cvResult<span class="sc">$</span>mse_fold, <span class="at">names=</span><span class="fu">as.character</span>(<span class="fu">round</span>(<span class="fu">colMeans</span>(cvResult<span class="sc">$</span>lam_seq), <span class="dv">3</span>)), </span>
<span id="cb76-6"><a href="Exposome_HELIX_analysis.html#cb76-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">&quot;averaged lambda over folds&quot;</span>, </span>
<span id="cb76-7"><a href="Exposome_HELIX_analysis.html#cb76-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;mean squared error&quot;</span>)</span></code></pre></div>
<p>From this model, we could select the <strong>optimal lambda value</strong> directly from the <strong>output</strong> with the <em>“cvResult$lambda.min”</em> argument, and then <strong>fit a new model</strong> with optimal hyperparameters.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="Exposome_HELIX_analysis.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#NOT DEFINITIVE</span></span>
<span id="cb77-2"><a href="Exposome_HELIX_analysis.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated execution time: approx. 1.40507 mins.</span></span>
<span id="cb77-3"><a href="Exposome_HELIX_analysis.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal lambda from CV</span></span>
<span id="cb77-4"><a href="Exposome_HELIX_analysis.html#cb77-4" aria-hidden="true" tabindex="-1"></a>cvResult<span class="sc">$</span>lambda.min</span>
<span id="cb77-5"><a href="Exposome_HELIX_analysis.html#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Training a new model with selected hype-parameter</span></span>
<span id="cb77-6"><a href="Exposome_HELIX_analysis.html#cb77-6" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">=</span><span class="fu">ds.Lasso_Train</span>(<span class="at">X=</span>X, <span class="at">Y=</span>Y_imp, <span class="at">type=</span><span class="st">&quot;regress&quot;</span>, <span class="at">lambda=</span>cvResult<span class="sc">$</span>lambda.min, <span class="at">nlambda=</span><span class="dv">5</span>, </span>
<span id="cb77-7"><a href="Exposome_HELIX_analysis.html#cb77-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">opts=</span>opts, <span class="at">C=</span><span class="dv">0</span>, <span class="at">datasources=</span>conns, <span class="at">nDigits=</span><span class="dv">4</span>)</span>
<span id="cb77-8"><a href="Exposome_HELIX_analysis.html#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of selected variables and their estimated coefficients</span></span>
<span id="cb77-9"><a href="Exposome_HELIX_analysis.html#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m4<span class="sc">$</span>ws,<span class="dv">2</span>,fun)</span>
<span id="cb77-10"><a href="Exposome_HELIX_analysis.html#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m4<span class="sc">$</span>ws, <span class="at">xlab=</span><span class="st">&quot;index of coefficients&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;values&quot;</span>)</span></code></pre></div>
<p>As previously mentioned, all these functions can be adapted for <strong>Ridge</strong> and <strong>Elastic-Net</strong> regression by properly tuning the <em>“C”</em> argument.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="Exposome_HELIX_analysis.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datashield.logout</span>(conns)</span></code></pre></div>
</div>
</div>
</div>
<h3> References.</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-WAREMBOURG20191317" class="csl-entry">
Warembourg, Charline, Léa Maitre, Ibon Tamayo-Uria, Serena Fossati, Theano Roumeliotaki, Gunn Marit Aasvang, Sandra Andrusaityte, et al. 2019. <span>“Early-Life Environmental Exposures and Blood Pressure in Children.”</span> <em>Journal of the American College of Cardiology</em> 74 (10): 1317–28. https://doi.org/<a href="https://doi.org/10.1016/j.jacc.2019.06.069">https://doi.org/10.1016/j.jacc.2019.06.069</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Datasets_Description.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references..html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["OmicSHIELD_bookdown.pdf", "OmicSHIELD_bookdown.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
